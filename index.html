<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#64CEAA"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#64CEAA">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"marvinliu1.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Take in the good!">
<meta property="og:type" content="website">
<meta property="og:title" content="Marvin&#39;s Blog">
<meta property="og:url" content="https://marvinliu1.github.io/index.html">
<meta property="og:site_name" content="Marvin&#39;s Blog">
<meta property="og:description" content="Take in the good!">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Marvin Liu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://marvinliu1.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Marvin's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Marvin's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Marvin's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>links</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Marvin Liu"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Marvin Liu</p>
  <div class="site-description" itemprop="description">Take in the good!</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/marvinliu1" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;marvinliu1" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:liuyongquan2010@gmail.com" title="E-Mail → mailto:liuyongquan2010@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


<div style="color:white;">document.designMode='on'</div>

        </div>
      </div>
    </div>
    
    <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
    <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
    <div class="widget-wrap">
        <h3 class="widget-title">Tags</h3>
        <div id="myCanvasContainer" class="widget tagcloud">
            <canvas width="250" height="250" id="resCanvas" style="width=100%">
                <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debugging/" rel="tag">Debugging</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MarkDown/" rel="tag">MarkDown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NeXt/" rel="tag">NeXt</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Next/" rel="tag">Next</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/" rel="tag">Node</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nuxt/" rel="tag">Nuxt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a><span class="tag-list-count">2</span></li></ul>
            </canvas>
        </div>
    </div>
    
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/marvinliu1" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2022/05/22/Adding%20links%20into%20Hexo%20NexT8%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/22/Adding%20links%20into%20Hexo%20NexT8%20/" class="post-title-link" itemprop="url">Hexo NexT8 主题添加友链页面</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-22 12:11:00" itemprop="dateCreated datePublished" datetime="2022-05-22T12:11:00-06:00">2022-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
    <span id="/2022/05/22/Adding%20links%20into%20Hexo%20NexT8%20/" class="post-meta-item leancloud_visitors" data-flag-title="Hexo NexT8 主题添加友链页面" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.litcu.cn/posts/9f2deaa1/">本文转载自Cu Blog</a></p>
<p>NexT 主题自带的并没有友链页面，本着 “可以不用但必须有” 的思想，我通过搜索引擎找到了可行的解决方案，在此记录，希望能帮到其他人。</p>
<p>NexT 版本：8.10.1。</p>
<p>先看一下最终效果吧：</p>
<p><a href="/images/blogs/favlinks.png"><img src="/images/blogs/favlinks.png" alt="img"></a></p>
<h2 id="NexT-配置文件修改"><a href="#NexT-配置文件修改" class="headerlink" title="NexT 配置文件修改"></a>NexT 配置文件修改</h2><p>打开<code>_config.next.yml</code> 文件，搜索<code>_data</code>，能够找到这样一条被注释的语句：<code>style: source/_data/styles.styl</code>，取消注释即可。</p>
<p>然后在 source 文件夹下新建<code>_data</code> 目录，并创建文件 styles.styl，在里面写入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">#links &#123;</span><br><span class="line"> margin-top: 5rem;</span><br><span class="line">&#125;</span><br><span class="line">.links-content &#123;</span><br><span class="line"> margin-top:1rem;</span><br><span class="line">&#125;</span><br><span class="line">.link-navigation::after &#123;</span><br><span class="line"> content: &quot; &quot;;</span><br><span class="line"> display: block;</span><br><span class="line"> clear: both;</span><br><span class="line">&#125;</span><br><span class="line">.card &#123;</span><br><span class="line"> width: 300px;</span><br><span class="line"> font-size: 1rem;</span><br><span class="line"> padding: 10px 20px;</span><br><span class="line"> border-radius: 4px;</span><br><span class="line"> transition-duration: 0.15s;</span><br><span class="line"> margin-bottom: 1rem;</span><br><span class="line"> display:flex;</span><br><span class="line">&#125;</span><br><span class="line">.card:nth-child(odd) &#123;</span><br><span class="line"> float: left;</span><br><span class="line">&#125;</span><br><span class="line">.card:nth-child(even) &#123;</span><br><span class="line"> float: right;</span><br><span class="line">&#125;</span><br><span class="line">.card:hover &#123;</span><br><span class="line"> transform: scale(1.1);</span><br><span class="line"> box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.12), 0 0 6px 0 rgba(0, 0, 0, 0.04);</span><br><span class="line">&#125;</span><br><span class="line">.card a &#123;</span><br><span class="line"> border:none;</span><br><span class="line">&#125;</span><br><span class="line">.card .ava &#123;</span><br><span class="line"> width: 3rem!important;</span><br><span class="line"> height: 3rem!important;</span><br><span class="line"> margin:0!important;</span><br><span class="line"> margin-right: 1em!important;</span><br><span class="line"> border-radius:4px;</span><br><span class="line">&#125;</span><br><span class="line">.card .card-header &#123;</span><br><span class="line"> font-style: italic;</span><br><span class="line"> overflow: hidden;</span><br><span class="line"> width: 236px;</span><br><span class="line">&#125;</span><br><span class="line">.card .card-header a &#123;</span><br><span class="line"> font-style: normal;</span><br><span class="line"> color: #2bbc8a;</span><br><span class="line"> font-weight: bold;</span><br><span class="line"> text-decoration: none;</span><br><span class="line">&#125;</span><br><span class="line">.card .card-header a:hover &#123;</span><br><span class="line"> color: #d480aa;</span><br><span class="line"> text-decoration: none;</span><br><span class="line">&#125;</span><br><span class="line">.card .card-header .info &#123;</span><br><span class="line"> font-style:normal;</span><br><span class="line"> color:#a3a3a3;</span><br><span class="line"> font-size:14px;</span><br><span class="line"> min-width: 0;</span><br><span class="line"> text-overflow: ellipsis;</span><br><span class="line"> overflow: hidden;</span><br><span class="line"> white-space: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后修改主页面板：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">友链: /links || fas fa-link</span><br></pre></td></tr></table></figure>

<h2 id="创建友链页面"><a href="#创建友链页面" class="headerlink" title="创建友链页面"></a>创建友链页面</h2><p>使用 <code>hexo new page link</code> 可以新建一个 link 页面，我们将其作为友链页面。创建完成后，写入以下内容（自己使用时请按需修改）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 友链</span><br><span class="line">type: links</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;links-content&quot;&gt;</span><br><span class="line">&lt;div class=&quot;no-icon note warning&quot;&gt;</span><br><span class="line">&lt;div class=&quot;link-info&quot;&gt;欢迎与我交换友链！&lt;/div&gt;&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;link-navigation&quot;&gt;</span><br><span class="line">&#123;% for link in site.data.links %&#125;</span><br><span class="line">&lt;div class=&quot;card&quot;&gt;&lt;img class=&quot;ava nomediumzoom&quot; src=&quot;&#123;&#123; link.avatar &#125;&#125;&quot;/&gt;</span><br><span class="line">&lt;div class=&quot;card-header&quot;&gt;</span><br><span class="line">&lt;div&gt;&lt;a href=&quot;&#123;&#123; link.site &#125;&#125;&quot; target=&quot;_blank&quot;&gt; &#123;&#123; link.name &#125;&#125;&lt;/a&gt; &lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;info&quot;&gt;&#123;&#123; link.info &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% note success %&#125;</span><br><span class="line"></span><br><span class="line">**友链申请条件：**</span><br><span class="line"></span><br><span class="line">- 网站内容符合中国大陆法律</span><br><span class="line">- 已开启HTTPS，且至少有3篇博客，最新一篇为三个月之内发表</span><br><span class="line">- 网站内容以原创为主，技术性博客优先，娱乐性博客除非特别感兴趣，否则不会考虑</span><br><span class="line"></span><br><span class="line">**友链格式：**</span><br><span class="line"></span><br><span class="line">```yaml</span><br><span class="line">- name: Cu Blog</span><br><span class="line">  site: https://www.litcu.cn</span><br><span class="line">  info: 安全新人小醋的快乐收集处</span><br><span class="line">  avatar: https://img.litcu.cn/avatar/avatar1.jpg</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>

<p>核心是 HTML 代码中的那个 for 循环，<code>site.data</code> 就是 <code>source/_data</code> 目录，后面的 <code>links</code> 就是我们之后要创建的 <code>links.yml</code> 友链文件。如果后续没有正常显示友链，可以看看这里是否出现了问题。</p>
<h2 id="添加友链"><a href="#添加友链" class="headerlink" title="添加友链"></a>添加友链</h2><p>在 <code>source/_data/</code> 目录下新建 link.yml 文件，写入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- name: Cu Blog</span><br><span class="line">  site: https://www.litcu.cn</span><br><span class="line">  info: 安全新人小醋的快乐收集处</span><br><span class="line">  avatar: https://img.litcu.cn/avatar/avatar1.jpg</span><br></pre></td></tr></table></figure>

<p>然后 <code>hexo cl &amp;&amp; hexo g &amp;&amp; hexo s</code> 就可以看到效果啦！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2020/09/25/How-To-Implement-Auth-in-Nuxt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/25/How-To-Implement-Auth-in-Nuxt/" class="post-title-link" itemprop="url">How To Implement Authentication in a Nuxt.js App</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-25 00:12:31" itemprop="dateCreated datePublished" datetime="2020-09-25T00:12:31-06:00">2020-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nuxt/" itemprop="url" rel="index"><span itemprop="name">Nuxt</span></a>
        </span>
    </span>

  
    <span id="/2020/09/25/How-To-Implement-Auth-in-Nuxt/" class="post-meta-item leancloud_visitors" data-flag-title="How To Implement Authentication in a Nuxt.js App" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/implementing-authentication-in-nuxtjs-app">Original published and copy-righted by Chimezie Enyinnaya</a><br><a target="_blank" rel="noopener" href="https://assets.digitalocean.com/">View more on digitalocean.com</a></p>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>In this tutorial, you’ll implement authentication in a <a target="_blank" rel="noopener" href="https://nuxtjs.org/">Nuxt.js</a> app using the <code>Auth</code> module.</p>
<p>For the purpose of this tutorial, you’ll be using <code>JWT</code> for authentication.</p>
<p>Below is a quick demo of what you’ll be building in this tutorial:</p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/2tWhMLqrSl2lC07r3JA5_nuxt-auth-demo.gif" alt="Animated gif of the app showing a user signing in"></p>
<p>You can find the <a target="_blank" rel="noopener" href="https://github.com/do-community/nuxt-auth-app">source code for this application at GitHub</a>.</p>
<p><strong>Warning:</strong> Several of the packages in this tutorial now contain dependencies with known vulnerabilities. In a production setting, you would resolve these issues by upgrading these packages, finding alternatives, or creating forked versions with patched fixes. However, within the limited context of a tutorial, it provides educational value as-is.</p>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>To complete this tutorial, you will need:</p>
<ul>
<li>Node.js installed locally, which you can do by following <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorial_series/how-to-install-node-js-and-create-a-local-development-environment">How to Install Node.js and Create a Local Development Environment</a>.</li>
<li>A valid Git installation is optionally required for cloning the API, consult <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-contribute-to-open-source-getting-started-with-git">Getting Started with Git</a>.</li>
</ul>
<p>Some familiarity with Vue.js and Nuxt.js may be beneficial. You can <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/vuejs-server-side-rendering-with-nuxtjs">refer to this post</a> if you’re getting started with Nuxt.js.</p>
<p>This tutorial was verified with Node v13.13.0, npm v6.14.4, <code>vue</code> v2.6.11, and <code>nuxt</code> v2.12.2.</p>
<h2 id="Step-1-—-Spinning-up-a-Sample-API"><a href="#Step-1-—-Spinning-up-a-Sample-API" class="headerlink" title="Step 1 — Spinning up a Sample API"></a>Step 1 — Spinning up a Sample API</h2><p>You are free to use whatever framework that works best for you. However, for quick development, this tutorial will clone an API built with <a target="_blank" rel="noopener" href="https://adonisjs.com/">AdonisJs</a>.</p>
<p>The API utilizes:</p>
<ul>
<li>JWT (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/JSON_Web_Token">JSON Web Tokens</a>) for authentication</li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SQLite">SQLite</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> enabled</li>
</ul>
<p>The API has three endpoints:</p>
<ul>
<li><code>/register</code>: endpoint for user registration</li>
<li><code>/login</code>: endpoint for authenticating users</li>
<li><code>/me</code>: endpoint for getting details for the currently authenticated user and it is protected by an <code>auth</code> middleware, which means a user must be authenticated to access the endpoint</li>
</ul>
<p>First, run the following command in your terminal window:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/do-community/jwt-auth-api.git</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Then, navigate to the project directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> jwt-auth-api</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And install the API dependencies:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p><strong>Note</strong>: When running install, you may encounter issues with <code>sqlite3</code> version <code>4.0.1</code> depending on the version of Node you are running. Refer to the <a target="_blank" rel="noopener" href="https://github.com/mapbox/node-sqlite3/blob/master/CHANGELOG.md">changelog</a> to determine compatibility with your environment.</p>
<p>At the time of original publication, the latest version of Node was 10. One option is to downgrade your version of Node to <code>10.20.1</code> (with the understanding that it is nearing end-of-life support). Then, run <code>npm install</code>.</p>
<p>A second option is to remove the <code>package-lock.json</code> file which will cause the system to look for <code>4.2.0</code> which is supported up to Node 13. You may need to also downgrade your version of Node to <code>13.13.0</code>. Then, run <code>npm install</code>.</p>
<p>A third option would be to modify <code>package.json</code> to a version of <code>sqlite3</code> supported by your current version of Node, remove <code>package-lock.json</code>, and run <code>npm install</code>. However, at the time of testing, <code>5.0.0</code> is not yet released to handle Node 14+ support.</p>
<p>Other symptoms of incompatibility include the following errors: <code>TypeError: Cannot read property &#39;data&#39; of undefined</code> and <code>Error: Cannot find module &#39;[...]/node_modules/sqlite3/lib/binding/[...]/node_sqlite3.node&#39;</code>.</p>
<p>Next, rename <code>.env.example</code> to <code>.env</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> .env.example .<span class="built_in">env</span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And generate an <code>APP_KEY</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx @adonisjs/cli@4.0.12 key:generate</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>You should see:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Outputgenerated: unique APP_KEY</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Once that’s coomplete, let’s run the migrations:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx @adonisjs/cli@4.0.12 migration:run</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Now, you can start the API:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ensure that you are in the `jwt-auth-api` project directory</span></span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>You can access the API on <code>http://127.0.0.1:3333/api</code>. Leave this running in a terminal window for the rest of the duration of the tutorial.</p>
<h2 id="Step-2-—-Creating-a-Nuxt-js-App"><a href="#Step-2-—-Creating-a-Nuxt-js-App" class="headerlink" title="Step 2 — Creating a Nuxt.js App"></a>Step 2 — Creating a Nuxt.js App</h2><p>Now, you can create a Nuxt.js app. Open a new terminal window and use <code>vue-cli</code> to initialize a new Vue project with the Nuxt starter template:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx vue-cli@2.9.6 init nuxt/starter nuxt-auth</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p><strong>Note:</strong> At the time of testing, <code>vue-cli</code> is deprecated. <code>@vue/cli</code> is the current command line tool for Vue projects. And <code>@vue/cli-init</code> is the recommended approach for legacy <code>vue-cli</code> projects. However, <code>create-nuxt-app</code> is the recommended approach for modern Nuxt projects.</p>
<p>Next, you need to navigate to the project directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> nuxt-auth</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And install the dependencies:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>Then, you can launch the app:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>The app should be running on <code>http://localhost:3000</code>. You can view the application in a web browser to see the default Vue application created by <code>vue-cli</code>.</p>
<h2 id="Step-3-—-Installing-Necessary-Nuxt-js-Modules"><a href="#Step-3-—-Installing-Necessary-Nuxt-js-Modules" class="headerlink" title="Step 3 — Installing Necessary Nuxt.js Modules"></a>Step 3 — Installing Necessary Nuxt.js Modules</h2><p>Now, let’s install the Nuxt.js modules that you’ll be needing for your app. You’ll be using the <a target="_blank" rel="noopener" href="https://auth.nuxtjs.org/">Nuxt Auth module</a> and the <a target="_blank" rel="noopener" href="https://axios.nuxtjs.org/">Nuxt Axios module</a>, since the <code>auth</code> module makes use of Axios internally:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ensure that you are in the `nuxt-auth` project directory</span></span><br><span class="line">npm install @nuxtjs/auth@4.5.1 @nuxtjs/axios@5.3.1 --save</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Once that’s completed, open <code>nuxt.config.js</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano nuxt.config.js</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Add the code below to <code>nuxt.config.js</code>:</p>
<p>nuxt.config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">modules</span>: [</span><br><span class="line">    <span class="string">&#x27;@nuxtjs/axios&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@nuxtjs/auth&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p><strong>Note:</strong> At this point, newer versions of Nuxt may encounter the error: <code>Enable vuex store by creating &#39;store/index.js&#39;</code>. This error can be resolved by <a target="_blank" rel="noopener" href="https://github.com/nuxt-community/auth-module/issues/104">adding an empty <code>index.js</code> file to the <code>store</code> directory</a>.</p>
<p>Next, you need to set up the modules. Paste the code below into <code>nuxt.config.js</code>:</p>
<p>nuxt.config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">axios</span>: &#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&#x27;http://127.0.0.1:3333/api&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">auth</span>: &#123;</span><br><span class="line">    <span class="attr">strategies</span>: &#123;</span><br><span class="line">      <span class="attr">local</span>: &#123;</span><br><span class="line">        <span class="attr">endpoints</span>: &#123;</span><br><span class="line">          <span class="attr">login</span>: &#123; <span class="attr">url</span>: <span class="string">&#x27;login&#x27;</span>, <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>, <span class="attr">propertyName</span>: <span class="string">&#x27;data.token&#x27;</span> &#125;,</span><br><span class="line">          <span class="attr">user</span>: &#123; <span class="attr">url</span>: <span class="string">&#x27;me&#x27;</span>, <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>, <span class="attr">propertyName</span>: <span class="string">&#x27;data&#x27;</span> &#125;,</span><br><span class="line">          <span class="attr">logout</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Here, you set the base URL that Axios will use when making requests. In our case, we are referencing the sample API we set up earlier.</p>
<p>Then, you define the authentication endpoints for the <code>local</code> strategy corresponding to those on your API:</p>
<ul>
<li>On successful authentication, the token will be available in the response as a <code>token</code> object inside a <code>data</code> object.</li>
<li>Similarly, the response from the <code>/me</code> endpoint will be inside a <code>data</code> object.</li>
<li>Lastly, you set <code>logout</code> to <code>false</code> since your API doesn’t have an endpoint for logout. You’ll just remove the token from localStorage when a user logs out.</li>
</ul>
<h2 id="Step-4-—-Creating-a-Navbar-Component"><a href="#Step-4-—-Creating-a-Navbar-Component" class="headerlink" title="Step 4 — Creating a Navbar Component"></a>Step 4 — Creating a Navbar Component</h2><p>To style your app, you can make use of <a target="_blank" rel="noopener" href="https://bulma.io/">Bulma</a>.</p>
<p>Open <code>nuxt.config.js</code> and paste the code below within the <code>link</code> object that is inside the <code>head</code> object:</p>
<p>nuxt.config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">head</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    link [</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">rel</span>: <span class="string">&#x27;stylesheet&#x27;</span>,</span><br><span class="line">        <span class="attr">href</span>: <span class="string">&#x27;https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Now, let’s create the Navbar component:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano components/Navbar.vue</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And add the following code:</p>
<p>components&#x2F;Navbar.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar is-light&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Nuxt Auth<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button navbar-burger&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-menu&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-end&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item has-dropdown is-hoverable&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-link&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              My Account</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-dropdown&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/profile&quot;</span>&gt;</span>My Profile<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">hr</span> <span class="attr">class</span>=<span class="string">&quot;navbar-divider&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/register&quot;</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>Log In<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>The Navbar component contains links to <code>login</code>, <code>register</code>, <code>profile</code>, and <code>logout</code>.</p>
<p>Next, let’s update the default layout to make use of the <code>Navbar</code> component.</p>
<p>Open <code>default.vue</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano layouts/default.vue</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And replace the content with the following:</p>
<p>layouts&#x2F;default.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Navbar</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">nuxt</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Navbar</span> <span class="keyword">from</span> <span class="string">&#x27;~/components/Navbar&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Navbar</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Also, let’s update the homepage.</p>
<p>Open <code>index.vue</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano pages/index.vue</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And replace the content with the following:</p>
<p>pages&#x2F;index.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Nuxt Auth<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>At this point, you should have an application that displays a title of <code>&quot;Nuxt Auth&quot;</code> with a header bar with navigation links:</p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/Y27FZj1TNm6tj0skgdhV_homepage.png" alt="App page with title and header bar"></p>
<h2 id="Step-5-—-Handling-User-Registration"><a href="#Step-5-—-Handling-User-Registration" class="headerlink" title="Step 5 — Handling User Registration"></a>Step 5 — Handling User Registration</h2><p>Inside the <code>pages</code> directory, create a new <code>register.vue</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano pages/register.vue</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And add the following code:</p>
<p>pages&#x2F;register.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;columns&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column is-4 is-offset-4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title has-text-centered&quot;</span>&gt;</span>Register!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Notification</span> <span class="attr">:message</span>=<span class="string">&quot;error&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;error&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> @<span class="attr">submit.prevent</span>=<span class="string">&quot;register&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">class</span>=<span class="string">&quot;input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">name</span>=<span class="string">&quot;username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">required</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">type</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">class</span>=<span class="string">&quot;input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">name</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">v-model</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">required</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">class</span>=<span class="string">&quot;input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">required</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button is-dark is-fullwidth&quot;</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;has-text-centered&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Already got an account? <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Notification</span> <span class="keyword">from</span> <span class="string">&#x27;~/components/Notification&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Notification</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">email</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">error</span>: <span class="literal">null</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">async</span> <span class="title function_">register</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$axios</span>.<span class="title function_">post</span>(<span class="string">&#x27;register&#x27;</span>, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">username</span>: <span class="variable language_">this</span>.<span class="property">username</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">email</span>: <span class="variable language_">this</span>.<span class="property">email</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">password</span>: <span class="variable language_">this</span>.<span class="property">password</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$auth</span>.<span class="title function_">loginWith</span>(<span class="string">&#x27;local&#x27;</span>, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">data</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">email</span>: <span class="variable language_">this</span>.<span class="property">email</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">password</span>: <span class="variable language_">this</span>.<span class="property">password</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125; <span class="keyword">catch</span> (e) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">error</span> = e.<span class="property">response</span>.<span class="property">data</span>.<span class="property">message</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>This contains a form with three fields: <code>username</code>, <code>email</code>, and <code>password</code>. Each field is bound to corresponding data on the component. When the form is submitted, a <code>register</code> method will be called. Using the Axios module, you make a post request to the <code>/register</code> endpoint, passing along the user data. If the registration was successful, you make use of the Auth module’s <code>loginWith()</code>, using the <code>local</code> strategy and passing the user data to log the user in. Then, you redirect the user to the homepage. If there is an error during the registration, you set the <code>error</code> data as the error message gotten from the API response.</p>
<p>If there is an error, the error message is displayed by a Notification component.</p>
<p>Create a new <code>Notification.vue</code> file inside <code>components</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano components/Notifaction.vue</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And paste the code below in it:</p>
<p>components&#x2F;Notification.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;notification is-danger&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; message &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;Notification&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>: [<span class="string">&#x27;message&#x27;</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>The Notification component accepts a <code>message</code> props, which is the error message.</p>
<p>Now, you can test out user registration:</p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/wOTj1xspRjiwMsaiWKt5_register.png" alt="Register page with Username, Email, and Password fields"></p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/qsHgdfDIR3ijyirZVqu4_register_failed.png" alt="Register page but with a notification message to the user that there was an error"></p>
<h2 id="Step-6-—-Handling-LoggedUsers-Logged-In-and-Logged-Out"><a href="#Step-6-—-Handling-LoggedUsers-Logged-In-and-Logged-Out" class="headerlink" title="Step 6 — Handling LoggedUsers Logged In and Logged Out"></a>Step 6 — Handling LoggedUsers Logged In and Logged Out</h2><p>Upon successful registration, users should be logged in but there is currently no way for the app to know whether users are logged in or not. So let’s fix that by updating the Navbar component and adding some computed properties.</p>
<p>Before you do just that, let’s first activate the Vuex store by creating an <code>index.js</code> file inside the <code>store</code> directory. The Auth module stores user authentication status as well as user details inside Vuex state in an <code>auth</code> object. So you can check if a user is logged in or not with <code>this.$store.state.auth.loggedIn</code>, which will either return <code>true</code> or <code>false</code>. Similarly, you can get a user’s details with <code>this.$store.state.auth.user</code>, which will be <code>null</code> if no user is logged in.</p>
<p><strong>Note:</strong> You can also access the user authentication status as well as the user details directly with the Auth module using <code>this.$auth.loggedIn</code> and <code>this.$auth.user</code> respectively.</p>
<p>Since you might want to use the computed properties in multiple places in your app, let’s create store getters.</p>
<p>Open <code>index.js</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano store/index.js</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And paste the code below in it:</p>
<p>store&#x2F;index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="title function_">isAuthenticated</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">auth</span>.<span class="property">loggedIn</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">loggedInUser</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">auth</span>.<span class="property">user</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Here, you create two getters. The first one (<code>isAuthenticated</code>) will return the authentication status of a user and the second (<code>loggedInUser</code>) will return the details or the logged in user.</p>
<p>Next, let’s update the Navbar component to make use of the getters. Replace the content of <code>components/Navbar.vue</code> with the following:</p>
<p>components&#x2F;Navbar.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar is-light&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Nuxt Auth<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button navbar-burger&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-menu&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-end&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item has-dropdown is-hoverable&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;isAuthenticated&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-link&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;&#123; loggedInUser.username &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-dropdown&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/profile&quot;</span>&gt;</span>My Profile<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">hr</span> <span class="attr">class</span>=<span class="string">&quot;navbar-divider&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/register&quot;</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>Log In<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapGetters</span>([<span class="string">&#x27;isAuthenticated&#x27;</span>, <span class="string">&#x27;loggedInUser&#x27;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>You create the computed properties by using the spread operator (<code>...</code>) to extract the getters from <code>mapGetters</code>. Then using <code>isAuthenticated</code>, you display the user menu or links to <code>login</code> or <code>register</code> depending on whether the user is logged in or not. Also, you use <code>loggedInUser</code> to display the authenticated user username.</p>
<p>Now, if you give your app a refresh, you should see something similar to below:</p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/NwqCBhzrSxysvLV832HE_loggedin.png" alt="App page with the user&#39;s username in the header"></p>
<h2 id="Step-7-—-Handling-User-Log-In"><a href="#Step-7-—-Handling-User-Log-In" class="headerlink" title="Step 7 — Handling User Log In"></a>Step 7 — Handling User Log In</h2><p>Now, let’s allow returning users the ability to log in.</p>
<p>Create a new <code>login.vue</code> file inside the <code>pages</code> directory:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano pages/login.vue</span><br></pre></td></tr></table></figure>

<p>And paste the code below in it:</p>
<p>pages&#x2F;login.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;columns&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column is-4 is-offset-4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title has-text-centered&quot;</span>&gt;</span>Welcome back!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Notification</span> <span class="attr">:message</span>=<span class="string">&quot;error&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;error&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> @<span class="attr">submit.prevent</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">type</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">class</span>=<span class="string">&quot;input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">name</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">v-model</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">class</span>=<span class="string">&quot;input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button is-dark is-fullwidth&quot;</span>&gt;</span>Log In<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;has-text-centered&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              Don&#x27;t have an account? <span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">to</span>=<span class="string">&quot;/register&quot;</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Notification</span> <span class="keyword">from</span> <span class="string">&#x27;~/components/Notification&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Notification</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">email</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">error</span>: <span class="literal">null</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$auth</span>.<span class="title function_">loginWith</span>(<span class="string">&#x27;local&#x27;</span>, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">data</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">email</span>: <span class="variable language_">this</span>.<span class="property">email</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">password</span>: <span class="variable language_">this</span>.<span class="property">password</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125; <span class="keyword">catch</span> (e) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">error</span> = e.<span class="property">response</span>.<span class="property">data</span>.<span class="property">message</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>This is quite similar to the <code>register</code> page. The form contains two fields: <code>email</code> and <code>password</code>. When the form is submitted, a <code>login</code> method will be called. Using the Auth module <code>loginWith()</code> and passing along the user data, you log the user in. If the authentication was successful, you redirect the user to the homepage. Otherwise, set <code>error</code> to the error message gotten from the API response. Again, you are using the Notification component from earlier on to display the error message.</p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/neC1nzCQeeBX5jgZZskQ_login.png" alt="App Welcome Back page containing two fields: email and password"></p>
<h2 id="Step-8-—-Displaying-the-User-Profile"><a href="#Step-8-—-Displaying-the-User-Profile" class="headerlink" title="Step 8 — Displaying the User Profile"></a>Step 8 — Displaying the User Profile</h2><p>Let’s allow logged in users to view their profile.</p>
<p>Create a new <code>profile.vue</code> file inside the <code>pages</code> directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano pages/profile.vue</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And paste the code below in it:</p>
<p>pages&#x2F;profile.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>My Profile<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">strong</span>&gt;</span>Username:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#123; loggedInUser.username &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">strong</span>&gt;</span>Email:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#123; loggedInUser.email &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapGetters</span>([<span class="string">&#x27;loggedInUser&#x27;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Notice how you are using the <code>loggedInUser</code> getter from earlier on to display the user details.</p>
<p>Clicking on the <strong>My Profile</strong> link should result in a <strong>My Profile</strong> page being displayed.</p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/UqKusiHSRCC2H7IcytjA_profile.png" alt="My Profile page displaying username and email"></p>
<h2 id="Step-9-—-Logging-Users-Out"><a href="#Step-9-—-Logging-Users-Out" class="headerlink" title="Step 9 — Logging Users Out"></a>Step 9 — Logging Users Out</h2><p>Update the logout link inside the Navbar component.</p>
<p>Open <code>Navbar.vue</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano components/Navbar.vue</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Modify the logout link to use <code>@click=&quot;logout&quot;</code>:</p>
<p>components&#x2F;Navbar.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;navbar-dropdown&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/profile&quot;</span>&gt;</span>My Profile<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">class</span>=<span class="string">&quot;navbar-divider&quot;</span>/&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-item&quot;</span>  @<span class="attr">click</span>=<span class="string">&quot;logout&quot;</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>When the logout link is clicked, it will trigger a <code>logout</code> method.</p>
<p>Next, let’s add the <code>logout</code> method inside the script section of the Navbar component:</p>
<p>components&#x2F;Navbar.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$auth</span>.<span class="title function_">logout</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>You call the <code>logout()</code> of the Auth module. This will delete the user’s token from localstorage and redirect the user to the homepage.</p>
<h2 id="Step-10-—-Restricting-the-Profile-Page"><a href="#Step-10-—-Restricting-the-Profile-Page" class="headerlink" title="Step 10 — Restricting the Profile Page"></a>Step 10 — Restricting the Profile Page</h2><p>As it stands now, anybody can visit the <code>profile</code> page. And if the user is not logged in, it will result in an error.</p>
<p><img src="https://assets.digitalocean.com/articles/implementing-authentication-in-nuxtjs-app/9UMgSTQCQUqSTGAdb6nY_profile_error.png" alt="TypeError on app page"></p>
<p>To fix this, you need to restrict the profile page to only logged in users. Luckily for us, you can achieve that with the Auth module. The Auth module comes with an <code>auth</code> middleware, which you can use in this scenario.</p>
<p>So let’s add the <code>auth</code> middleware to the <code>profile</code> page. Update the <code>script</code> section as below:</p>
<p>pages&#x2F;profile.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">middleware</span>: <span class="string">&#x27;auth&#x27;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Now when a user that is not logged in tries to visit the <code>profile</code> page, the user will be redirected to the <code>login</code> page.</p>
<h2 id="Step-11-—-Creating-a-Guest-Middleware"><a href="#Step-11-—-Creating-a-Guest-Middleware" class="headerlink" title="Step 11 — Creating a Guest Middleware"></a>Step 11 — Creating a Guest Middleware</h2><p>Again as it stands, even as a logged in user, you can still access the login and register pages. One way to fix that is to restrict login and register pages to only users that are not logged in. You can do that by creating a guest middleware.</p>
<p>Inside the <code>middleware</code> directory, create a new <code>guest.js</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano middleware/guest.js</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>And paste the code below in it:</p>
<p>middleware&#x2F;guest.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">&#123; store, redirect &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">state</span>.<span class="property">auth</span>.<span class="property">loggedIn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>A middleware accepts the context as its first argument. So you extract <code>store</code> and <code>redirect</code> from the context. Then, you check if the user is logged in then redirect the user to the homepage. Otherwise, you allow the normal execution of the request.</p>
<p>Next, let’s make use of this middleware. Update the <code>script</code> section of both <code>login</code> and <code>register</code> as below:</p>
<p>pages&#x2F;login.vue and pages&#x2F;register.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">middleware</span>: <span class="string">&#x27;guest&#x27;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>Now, everything will be working as expected.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this tutorial, you looked at how to implement authentication in a Nuxt.js application using the Auth module. You also saw how to keep the authentication flow sleek by making use of middleware.</p>
<p>To learn more about the Auth module, check out the <a target="_blank" rel="noopener" href="https://auth.nuxtjs.org/">docs</a>.</p>
<p>If you’d like to learn more about Vue.js, check out <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tags/vue-js">our Vue.js topic page</a> for exercises and programming projects.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2020/05/21/Markdown%E5%85%AC%E5%BC%8F%E7%94%A8%E6%B3%95%E5%A4%A7%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/21/Markdown%E5%85%AC%E5%BC%8F%E7%94%A8%E6%B3%95%E5%A4%A7%E5%85%A8/" class="post-title-link" itemprop="url">Markdown公式用法大全</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-21 00:12:31" itemprop="dateCreated datePublished" datetime="2020-05-21T00:12:31-06:00">2020-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
    <span id="/2020/05/21/Markdown%E5%85%AC%E5%BC%8F%E7%94%A8%E6%B3%95%E5%A4%A7%E5%85%A8/" class="post-meta-item leancloud_visitors" data-flag-title="Markdown公式用法大全" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>Markdown是一种轻量级标记语言</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一级标题</span></span><br><span class="line"><span class="comment">## 二级标题</span></span><br><span class="line"><span class="comment">### 三级标题</span></span><br><span class="line"><span class="comment">#### 四级标题</span></span><br><span class="line"><span class="comment">##### 五级标题</span></span><br><span class="line"><span class="comment">###### 六级标题</span></span><br><span class="line">**加粗**</span><br><span class="line">*斜体*</span><br><span class="line">==高亮==</span><br></pre></td></tr></table></figure>

<h4 id="两种代码引用方式"><a href="#两种代码引用方式" class="headerlink" title="两种代码引用方式"></a>两种代码引用方式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">``式或```式</span><br></pre></td></tr></table></figure>

<h4 id="插入链接并描述"><a href="#插入链接并描述" class="headerlink" title="插入链接并描述"></a>插入链接并描述</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[博客]</span>(<span class="attribute">https</span>:<span class="comment">//www.cnblogs.com/ &quot;博客&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![路飞](https://pic.baike.soso.com/ugc/baikepic2/0/ori-20190529230042-1249666563_jpeg_640_960_59726.jpg/800 <span class="string">&#x27;路飞&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">one</span></span><br><span class="line"><span class="number">2.</span>two</span><br><span class="line"><span class="number">3.</span>three</span><br></pre></td></tr></table></figure>

<h4 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> one</span><br><span class="line"><span class="bullet">*</span> two</span><br><span class="line"><span class="bullet">*</span> three</span><br></pre></td></tr></table></figure>

<h4 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h4 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name | age | sex</span><br><span class="line"><span class="section">:-: | :- | -:</span></span><br><span class="line">tony|20|男</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">name</th>
<th align="left">age</th>
<th align="center">sex</th>
</tr>
</thead>
<tbody><tr>
<td align="center">tony</td>
<td align="left">20</td>
<td align="center">男</td>
</tr>
</tbody></table>
<p>注：代码中第二行分别表示居中，右对齐，左对齐，若结果不显示，转化成源代码模式去掉行与行之间的空行。</p>
<h3 id="如何插入公式"><a href="#如何插入公式" class="headerlink" title="如何插入公式"></a>如何插入公式</h3><p>数学公式有两种：行中公式（与文字搭配使用）和独立公式（独立成行）</p>
<p>行内公式表示：<code>$ 数学公式 $</code></p>
<p>独立公式表示：<code>$$ 数学公式 $$</code></p>
<h3 id="如何输入上下标"><a href="#如何输入上下标" class="headerlink" title="如何输入上下标"></a>如何输入上下标</h3><p><code>^</code> 表示上标, <code>_</code> 表示下标。如果上下标的内容多于一个字符，需要用 <code>&#123;&#125;</code> 将这些内容括成一个整体。上下标可以嵌套，也可以同时使用。</p>
<p>如：<code>$$ x^&#123;y^z&#125;=(1+&#123;\rm e&#125;^x)^&#123;-2xy^w&#125; $$</code>,显示：$x{yz}&#x3D;(1+{\rm e}x){-2xy^w} $</p>
<p>另外，如果要在左右两边都有上下标，可以用 <code>\sideset</code> 命令。</p>
<p>如：<code>$$ \sideset&#123;^1_2&#125;&#123;^3_4&#125;\bigotimes $$</code>,显示：$ \sideset{1_2}{3_4}\bigotimes $</p>
<h3 id="如何输入括号和分隔符"><a href="#如何输入括号和分隔符" class="headerlink" title="如何输入括号和分隔符"></a>如何输入括号和分隔符</h3><p><code>()</code>、<code>[]</code> 和 <code>|</code> 表示符号本身，使用 <code>\&#123;\&#125;</code> 来表示 <code>&#123;&#125;</code> 。当要显示大号的括号或分隔符时，要用 <code>\left</code> 和 <code>\right</code> 命令。</p>
<table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\langle</td>
<td align="center">⟨⟨</td>
<td align="center">\rangle</td>
<td align="center">⟩⟩</td>
</tr>
<tr>
<td align="center">\lceil</td>
<td align="center">⌈⌈</td>
<td align="center">\rceil</td>
<td align="center">⌉⌉</td>
</tr>
<tr>
<td align="center">\lfloor</td>
<td align="center">⌊⌊</td>
<td align="center">\rfloor</td>
<td align="center">⌋⌋</td>
</tr>
<tr>
<td align="center">\lbrace</td>
<td align="center">{ {</td>
<td align="center">\rbrace</td>
<td align="center">} }</td>
</tr>
</tbody></table>
<p>如：<code>$$ f(x,y,z) = 3y^2z \left( 3+\frac&#123;7x+5&#125;&#123;1+y^2&#125; \right) $$</code>,显示：f(x,y,z)&#x3D;3y2z(3+7x+51+y2)f(x,y,z)&#x3D;3y2z(3+7x+51+y2)</p>
<p>有时候要用 <code>\left.</code> 或 <code>\right.</code> 进行匹配而不显示本身。</p>
<p>如：<code>$$ \left. \frac&#123;&#123;\rm d&#125;u&#125;&#123;&#123;\rm d&#125;x&#125; \right| _&#123;x=0&#125; $$`,显示：[MathProcessingError]dudx∣∣x=0[MathProcessingError]dudx|x=0

### 如何输入分数

通常使用 `\frac &#123;分子&#125; &#123;分母&#125;` 命令产生一个分数，分数可嵌套。便捷情况可直接输入 `\frac ab` 来快速生成一个 abab 。
如果分式很复杂，亦可使用 `分子 \over 分母` 命令，此时分数仅有一层。

如：`$$ \frac&#123;a-1&#125;&#123;b-1&#125; \quad and \quad &#123;a+1\over b+1&#125; $$`,显示：a−1b−1anda+1b+1a−1b−1anda+1b+1

### 如何输入开方

使用 `\sqrt [根指数，省略时为2] &#123;被开方数&#125;` 命令输入开方。

如：`$$ \sqrt&#123;2&#125; \quad and \quad \sqrt[n]&#123;3&#125; $$`,显示：2–√and3–√n2and3n

### 如何输入省略号

数学公式中常见的省略号有两种，`\ldots` 表示与文本底线对齐的省略号，`\cdots` 表示与文本中线对齐的省略号。

如：`$$ f(x_1,x_2,\underbrace&#123;\ldots&#125;_&#123;\rm ldots&#125; ,x_n) = x_1^2 + x_2^2 + \underbrace&#123;\cdots&#125;_&#123;\rm cdots&#125; + x_n^2 $$`,显示：$ f(x_1,x_2,\underbrace&#123;\ldots&#125;*&#123;\rm ldots&#125; ,x_n) = x_1^2 + x_2^2 + \underbrace&#123;\cdots&#125;*&#123;\rm cdots&#125; + x_n^2 $

### 如何输入矢量

使用 `\vec&#123;矢量&#125;` 来自动产生一个矢量。也可以使用 `\overrightarrow` 等命令自定义字母上方的符号。

如：`$$ \vec&#123;a&#125; \cdot \vec&#123;b&#125;=0 $$`,显示：

a⃗ ⋅b⃗ =0a→⋅b→=0



如：`$$ \overleftarrow&#123;xy&#125; \quad and \quad \overleftrightarrow&#123;xy&#125; \quad and \quad \overrightarrow&#123;xy&#125; $$`,显示：

xy←−andxy←→andxy−→xy←andxy↔andxy→



### 如何输入积分

使用 `\int_积分下限^积分上限 &#123;被积表达式&#125;` 来输入一个积分。

如：`$$ \int_0^1 &#123;x^2&#125; \,&#123;\rm d&#125;x $$`,显示：∫10x2,dx∫01x2,dx,例中 `\,` 和 `&#123;\rm d&#125;` 部分可省略，建议加入，使式子更美观。

### 如何输入极限运算

使用 `\lim_&#123;变量 \to 表达式&#125; 表达式` 来输入一个极限。如有需求，可以更改 `\to` 符号至任意符号。

如：`$$ \lim_&#123;n \to +\infty&#125; \frac&#123;1&#125;&#123;n(n+1)&#125; \quad and \quad \lim_&#123;x\leftarrow&#123;示例&#125;&#125; \frac&#123;1&#125;&#123;n(n+1)&#125; $$</code>,显示：</p>
<p>limn→+∞1n(n+1)andlimx←示例1n(n+1)limn→+∞1n(n+1)andlimx←示例1n(n+1)</p>
<h3 id="如何输入累加、累乘运算"><a href="#如何输入累加、累乘运算" class="headerlink" title="如何输入累加、累乘运算"></a>如何输入累加、累乘运算</h3><p>使用 <code>\sum_&#123;下标表达式&#125;^&#123;上标表达式&#125; &#123;累加表达式&#125;</code> 来输入一个累加。与之类似，使用 <code>\prod</code> <code>\bigcup</code> <code>\bigcap</code> 来分别输入累乘、并集和交集。此类符号在行内显示时上下标表达式将会移至右上角和右下角。</p>
<p>如：<code>$$ \sum_&#123;i=1&#125;^n \frac&#123;1&#125;&#123;i^2&#125; \quad and \quad \prod_&#123;i=1&#125;^n \frac&#123;1&#125;&#123;i^2&#125; \quad and \quad \bigcup_&#123;i=1&#125;^&#123;2&#125; R $$</code>,显示：∑ni&#x3D;11i2and∏ni&#x3D;11i2and⋃2i&#x3D;1R∑i&#x3D;1n1i2and∏i&#x3D;1n1i2and⋃i&#x3D;12R</p>
<h3 id="如何输入希腊字母"><a href="#如何输入希腊字母" class="headerlink" title="如何输入希腊字母"></a>如何输入希腊字母</h3><p>输入 <code>\小写希腊字母英文全称</code> 和 <code>\首字母大写希腊字母英文全称</code> 来分别输入小写和大写希腊字母,对于大写希腊字母与现有字母相同的，直接输入大写字母即可。</p>
<table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\alpha</td>
<td align="center">αα</td>
<td align="center">A</td>
<td align="center">AA</td>
<td align="center">\beta</td>
<td align="center">ββ</td>
<td align="center">B</td>
<td align="center">BB</td>
</tr>
<tr>
<td align="center">\gamma</td>
<td align="center">γγ</td>
<td align="center">\Gamma</td>
<td align="center">ΓΓ</td>
<td align="center">\delta</td>
<td align="center">δδ</td>
<td align="center">\Delta</td>
<td align="center">ΔΔ</td>
</tr>
<tr>
<td align="center">\epsilon</td>
<td align="center">ϵϵ</td>
<td align="center">E</td>
<td align="center">EE</td>
<td align="center">\zeta</td>
<td align="center">ζζ</td>
<td align="center">Z</td>
<td align="center">ZZ</td>
</tr>
<tr>
<td align="center">\eta</td>
<td align="center">ηη</td>
<td align="center">H</td>
<td align="center">HH</td>
<td align="center">\theta</td>
<td align="center">θθ</td>
<td align="center">\Theta</td>
<td align="center">ΘΘ</td>
</tr>
<tr>
<td align="center">\iota</td>
<td align="center">ιι</td>
<td align="center">I</td>
<td align="center">II</td>
<td align="center">\kappa</td>
<td align="center">κκ</td>
<td align="center">K</td>
<td align="center">KK</td>
</tr>
<tr>
<td align="center">\lambda</td>
<td align="center">λλ</td>
<td align="center">\Lambda</td>
<td align="center">ΛΛ</td>
<td align="center">\mu</td>
<td align="center">μμ</td>
<td align="center">M</td>
<td align="center">MM</td>
</tr>
<tr>
<td align="center">\nu</td>
<td align="center">νν</td>
<td align="center">N</td>
<td align="center">NN</td>
<td align="center">\xi</td>
<td align="center">ξξ</td>
<td align="center">\Xi</td>
<td align="center">ΞΞ</td>
</tr>
<tr>
<td align="center">o</td>
<td align="center">oo</td>
<td align="center">O</td>
<td align="center">OO</td>
<td align="center">\pi</td>
<td align="center">ππ</td>
<td align="center">\Pi</td>
<td align="center">ΠΠ</td>
</tr>
<tr>
<td align="center">\rho</td>
<td align="center">ρρ</td>
<td align="center">P</td>
<td align="center">PP</td>
<td align="center">\sigma</td>
<td align="center">σσ</td>
<td align="center">\Sigma</td>
<td align="center">ΣΣ</td>
</tr>
<tr>
<td align="center">\tau</td>
<td align="center">ττ</td>
<td align="center">T</td>
<td align="center">TT</td>
<td align="center">\upsilon</td>
<td align="center">υυ</td>
<td align="center">\Upsilon</td>
<td align="center">ΥΥ</td>
</tr>
<tr>
<td align="center">\phi</td>
<td align="center">ϕϕ</td>
<td align="center">\Phi</td>
<td align="center">ΦΦ</td>
<td align="center">\chi</td>
<td align="center">χχ</td>
<td align="center">X</td>
<td align="center">XX</td>
</tr>
<tr>
<td align="center">\psi</td>
<td align="center">ψψ</td>
<td align="center">\Psi</td>
<td align="center">ΨΨ</td>
<td align="center">\omega</td>
<td align="center">ωω</td>
<td align="center">\Omega</td>
<td align="center">ΩΩ</td>
</tr>
</tbody></table>
<p>部分字母有变量专用形式，以 <code>\var-</code> 开头。</p>
<table>
<thead>
<tr>
<th align="center">小写形式</th>
<th align="center">大写形式</th>
<th align="center">变量形式</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\epsilon</td>
<td align="center">E</td>
<td align="center">\varepsilon</td>
<td align="center">ϵ∣E∣εϵ∣E∣ε</td>
</tr>
<tr>
<td align="center">\theta</td>
<td align="center">\Theta</td>
<td align="center">\vartheta</td>
<td align="center">θ∣Θ∣ϑθ∣Θ∣ϑ</td>
</tr>
<tr>
<td align="center">\rho</td>
<td align="center">P</td>
<td align="center">\varrho</td>
<td align="center">ρ∣P∣ϱρ∣P∣ϱ</td>
</tr>
<tr>
<td align="center">\sigma</td>
<td align="center">\Sigma</td>
<td align="center">\varsigma</td>
<td align="center">σ∣Σ∣ςσ∣Σ∣ς</td>
</tr>
<tr>
<td align="center">\phi</td>
<td align="center">\Phi</td>
<td align="center">\varphi</td>
<td align="center">ϕ∣Φ∣φϕ∣Φ∣φ</td>
</tr>
</tbody></table>
<h3 id="如何输入其它特殊字符"><a href="#如何输入其它特殊字符" class="headerlink" title="如何输入其它特殊字符"></a>如何输入其它特殊字符</h3><p>若需要显示更大或更小的字符，在符号前插入 <code>\large</code> 或 <code>\small</code> 命令。若找不到需要的符号，使用 <a target="_blank" rel="noopener" href="http://detexify.kirelabs.org/classify.html">Detexify2Detexify2</a> 来画出想要的符号。</p>
<h4 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\pm</td>
<td align="center">±±</td>
<td align="center">\times</td>
<td align="center">××</td>
<td align="center">\div</td>
<td align="center">÷÷</td>
<td align="center">\mid</td>
<td align="center">∣∣</td>
</tr>
<tr>
<td align="center">\nmid</td>
<td align="center">∤∤</td>
<td align="center">\cdot</td>
<td align="center">⋅⋅</td>
<td align="center">\circ</td>
<td align="center">∘∘</td>
<td align="center">\ast</td>
<td align="center">∗∗</td>
</tr>
<tr>
<td align="center">\bigodot</td>
<td align="center">⨀⨀</td>
<td align="center">\bigotimes</td>
<td align="center">⨂⨂</td>
<td align="center">\bigoplus</td>
<td align="center">⨁⨁</td>
<td align="center">\leq</td>
<td align="center">≤≤</td>
</tr>
<tr>
<td align="center">\geq</td>
<td align="center">≥≥</td>
<td align="center">\neq</td>
<td align="center">≠≠</td>
<td align="center">\approx</td>
<td align="center">≈≈</td>
<td align="center">\equiv</td>
<td align="center">≡≡</td>
</tr>
<tr>
<td align="center">\sum</td>
<td align="center">∑∑</td>
<td align="center">\prod</td>
<td align="center">∏∏</td>
<td align="center">\coprod</td>
<td align="center">∐∐</td>
<td align="center">\backslash</td>
<td align="center">∖∖</td>
</tr>
</tbody></table>
<h4 id="集合运算符"><a href="#集合运算符" class="headerlink" title="集合运算符"></a>集合运算符</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\emptyset</td>
<td align="center">∅∅</td>
<td align="center">\in</td>
<td align="center">∈∈</td>
<td align="center">\notin</td>
<td align="center">∉∉</td>
</tr>
<tr>
<td align="center">\subset</td>
<td align="center">⊂⊂</td>
<td align="center">\supset</td>
<td align="center">⊃⊃</td>
<td align="center">\subseteq</td>
<td align="center">⊆⊆</td>
</tr>
<tr>
<td align="center">\supseteq</td>
<td align="center">⊇⊇</td>
<td align="center">\bigcap</td>
<td align="center">⋂⋂</td>
<td align="center">\bigcup</td>
<td align="center">⋃⋃</td>
</tr>
<tr>
<td align="center">\bigvee</td>
<td align="center">⋁⋁</td>
<td align="center">\bigwedge</td>
<td align="center">⋀⋀</td>
<td align="center">\biguplus</td>
<td align="center">⨄⨄</td>
</tr>
</tbody></table>
<h4 id="对数运算符"><a href="#对数运算符" class="headerlink" title="对数运算符"></a>对数运算符</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\log</td>
<td align="center">loglog</td>
<td align="center">\lg</td>
<td align="center">lglg</td>
<td align="center">\ln</td>
<td align="center">lnln</td>
</tr>
</tbody></table>
<h4 id="三角运算符"><a href="#三角运算符" class="headerlink" title="三角运算符"></a>三角运算符</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">30^\circ</td>
<td align="center">30∘30∘</td>
<td align="center">\bot</td>
<td align="center">⊥⊥</td>
<td align="center">\angle A</td>
<td align="center">∠A∠A</td>
</tr>
<tr>
<td align="center">\sin</td>
<td align="center">sinsin</td>
<td align="center">\cos</td>
<td align="center">coscos</td>
<td align="center">\tan</td>
<td align="center">tantan</td>
</tr>
<tr>
<td align="center">\csc</td>
<td align="center">csccsc</td>
<td align="center">\sec</td>
<td align="center">secsec</td>
<td align="center">\cot</td>
<td align="center">cotcot</td>
</tr>
</tbody></table>
<h4 id="微积分运算符"><a href="#微积分运算符" class="headerlink" title="微积分运算符"></a>微积分运算符</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\int</td>
<td align="center">∫∫</td>
<td align="center">\iint</td>
<td align="center">∬∬</td>
<td align="center">\iiint</td>
<td align="center">∭∭</td>
</tr>
<tr>
<td align="center">\iiiint</td>
<td align="center">∬∬⨌</td>
<td align="center">\oint</td>
<td align="center">∮∮</td>
<td align="center">\prime</td>
<td align="center">′′</td>
</tr>
<tr>
<td align="center">\lim</td>
<td align="center">limlim</td>
<td align="center">\infty</td>
<td align="center">∞∞</td>
<td align="center">\nabla</td>
<td align="center">∇∇</td>
</tr>
</tbody></table>
<h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\because</td>
<td align="center">∵∵</td>
<td align="center">\therefore</td>
<td align="center">∴∴</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">\forall</td>
<td align="center">∀∀</td>
<td align="center">\exists</td>
<td align="center">∃∃</td>
<td align="center">\not\subset</td>
<td align="center">⊄⊄</td>
</tr>
<tr>
<td align="center">\not&lt;</td>
<td align="center">≮≮</td>
<td align="center">\not&gt;</td>
<td align="center">≯≯</td>
<td align="center">\not&#x3D;</td>
<td align="center">≠≠</td>
</tr>
</tbody></table>
<h4 id="戴帽符号"><a href="#戴帽符号" class="headerlink" title="戴帽符号"></a>戴帽符号</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\hat{xy}</td>
<td align="center">xy^xy^</td>
<td align="center">\widehat{xyz}</td>
<td align="center">xyzˆxyz^</td>
</tr>
<tr>
<td align="center">\tilde{xy}</td>
<td align="center">xy<del>xy</del></td>
<td align="center">\widetilde{xyz}</td>
<td align="center">xyz˜xyz~</td>
</tr>
<tr>
<td align="center">\check{x}</td>
<td align="center">xˇxˇ</td>
<td align="center">\breve{y}</td>
<td align="center">y˘y˘</td>
</tr>
<tr>
<td align="center">\grave{x}</td>
<td align="center">x<code>x</code></td>
<td align="center">\acute{y}</td>
<td align="center">y´y´</td>
</tr>
</tbody></table>
<h4 id="连线符号"><a href="#连线符号" class="headerlink" title="连线符号"></a>连线符号</h4><table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\fbox{a+b+c+d}</td>
<td align="center">a+b+c+da+b+c+d</td>
</tr>
<tr>
<td align="center">\overleftarrow{a+b+c+d}</td>
<td align="center">a+b+c+d←−−−a+b+c+d←</td>
</tr>
<tr>
<td align="center">\overrightarrow{a+b+c+d}</td>
<td align="center">a+b+c+d−→−−a+b+c+d→</td>
</tr>
<tr>
<td align="center">\overleftrightarrow{a+b+c+d}</td>
<td align="center">a+b+c+d←→−a+b+c+d↔</td>
</tr>
<tr>
<td align="center">\underleftarrow{a+b+c+d}</td>
<td align="center">a+b+c+d←−−−a+b+c+d←</td>
</tr>
<tr>
<td align="center">\underrightarrow{a+b+c+d}</td>
<td align="center">a+b+c+d−→−−a+b+c+d→</td>
</tr>
<tr>
<td align="center">\underleftrightarrow{a+b+c+d}</td>
<td align="center">a+b+c+d←→−a+b+c+d↔</td>
</tr>
<tr>
<td align="center">\overline{a+b+c+d}</td>
<td align="center">a+b+c+d¯¯¯¯¯¯¯¯¯¯¯a+b+c+d¯</td>
</tr>
<tr>
<td align="center">\underline{a+b+c+d}</td>
<td align="center">a+b+c+d–––––a+b+c+d_</td>
</tr>
<tr>
<td align="center">\overbrace{a+b+c+d}^{Sample}</td>
<td align="center">a+b+c+dSamplea+b+c+d⏞Sample</td>
</tr>
<tr>
<td align="center">\underbrace{a+b+c+d}_{Sample}</td>
<td align="center">a+b+c+dSamplea+b+c+d⏟Sample</td>
</tr>
<tr>
<td align="center">\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}</td>
<td align="center">a+b+c1.0+d2.0a+b+c⏟1.0+d⏞2.0</td>
</tr>
<tr>
<td align="center">\underbrace{a\cdot a\cdots a}_{b\text{ times}}</td>
<td align="center">a⋅a⋯ab timesa⋅a⋯a⏟b times</td>
</tr>
</tbody></table>
<h4 id="箭头符号"><a href="#箭头符号" class="headerlink" title="箭头符号"></a>箭头符号</h4><ul>
<li>推荐使用符号：<br>|输入|显示|输入|显示|输入|显示|<br>|:–😐:–😐:–😐:–😐:–😐:–😐<br>|\to|$ \to|↦||↦| \mapsto||||⟹|||||⟹| \implies|⟺||⟺| \iff|⟸||⟸| \impliedby$|</li>
<li>其它可用符号：<br>|输入|显示|输入|显示|<br>|:–😐:–😐:–😐:–😐<br>|\uparrow|$ \uparrow|⇑||⇑| \Uparrow||↓|||↓| \downarrow|⇓||⇓| \Downarrow||←|||←| \leftarrow|⇐||⇐| \Leftarrow||→|||→| \rightarrow|⇒||⇒| \Rightarrow||↔|||↔| \leftrightarrow|⇔||⇔| \Leftrightarrow||⟵|||⟵| \longleftarrow|⟸||⟸| \Longleftarrow||⟶|||⟶| \longrightarrow|⟹||⟹| \Longrightarrow||⟷|||⟷| \longleftrightarrow|⟺||⟺| \Longleftrightarrow$|</li>
</ul>
<h3 id="如何进行字体转换"><a href="#如何进行字体转换" class="headerlink" title="如何进行字体转换"></a>如何进行字体转换</h3><p>若要对公式的某一部分字符进行字体转换，可以用 <code>&#123;\字体 &#123;需转换的部分字符&#125;&#125;</code> 命令，其中 <code>\字体</code> 部分可以参照下表选择合适的字体。一般情况下，公式默认为意大利体 italicitalic 。示例中 全部大写 的字体仅大写可用。</p>
<table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">说明</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">说明</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\rm</td>
<td align="center">罗马体</td>
<td align="center">SampleSample</td>
<td align="center">\cal</td>
<td align="center">花体</td>
<td align="center">SAMPLESAMPLE</td>
</tr>
<tr>
<td align="center">\it</td>
<td align="center">意大利体</td>
<td align="center">SampleSample</td>
<td align="center">\Bbb</td>
<td align="center">黑板粗体</td>
<td align="center">SAMPLESAMPLE</td>
</tr>
<tr>
<td align="center">\bf</td>
<td align="center">粗体</td>
<td align="center">SampleSample</td>
<td align="center">\mit</td>
<td align="center">数学斜体</td>
<td align="center">SAMPLESAMPLE</td>
</tr>
<tr>
<td align="center">\sf</td>
<td align="center">等线体</td>
<td align="center">SampleSample</td>
<td align="center">\scr</td>
<td align="center">手写体</td>
<td align="center">SAMPLESAMPLE</td>
</tr>
<tr>
<td align="center">\tt</td>
<td align="center">打字机体</td>
<td align="center">SampleSample</td>
<td align="center">\frak</td>
<td align="center">旧德式字体</td>
<td align="center">SampleSample</td>
</tr>
</tbody></table>
<p>转换字体十分常用，例如在积分中：</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\<span class="keyword">begin</span>&#123;array&#125;&#123;cc&#125;</span><br><span class="line">\<span class="keyword">mathrm</span>&#123;Bad&#125; <span class="operator">&amp;</span> \<span class="keyword">mathrm</span>&#123;Better&#125; \\</span><br><span class="line">\hline \\</span><br><span class="line">\int_0<span class="operator">^</span><span class="number">1</span> x<span class="operator">^</span><span class="number">2</span> dx <span class="operator">&amp;</span> \int_0<span class="operator">^</span><span class="number">1</span> x<span class="operator">^</span><span class="number">2</span> \,&#123;\rm d&#125;x</span><br><span class="line">\<span class="keyword">end</span>&#123;array&#125;</span><br></pre></td></tr></table></figure>

<p>显示：\begin{array}{cc}<br>\mathrm{Bad} &amp; \mathrm{Better} \<br>\hline \<br>\int_0^1 x^2 dx &amp; \int_0^1 x^2 ,{\rm d}x<br>\end{array}\begin{array}{cc} \mathrm{Bad} &amp; \mathrm{Better} \ \hline \ \int_0^1 x^2 dx &amp; \int_0^1 x^2 ,{\rm d}x \end{array},注意比较两个式子间 dxdx 与 dxdx 的不同。</p>
<h3 id="如何使用大括号和行标"><a href="#如何使用大括号和行标" class="headerlink" title="如何使用大括号和行标"></a>如何使用大括号和行标</h3><p>使用 <code>\left</code> 和 <code>\right</code> 来创建自动匹配高度的 (圆括号)，[方括号] 和 {花括号} ，在每个公式末尾前使用 <code>\tag&#123;行标&#125;</code> 来实现行标。</p>
<ul>
<li>例如：</li>
</ul>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">$</span><span class="operator">$</span></span><br><span class="line">f\left(</span><br><span class="line">   \left[ </span><br><span class="line">     \<span class="keyword">frac</span>&#123;</span><br><span class="line">       <span class="number">1</span><span class="operator">+</span>\left\&#123;x,y\right\&#125;</span><br><span class="line">     &#125;&#123;</span><br><span class="line">       \left(</span><br><span class="line">          \<span class="keyword">frac</span>&#123;x&#125;&#123;y&#125;<span class="operator">+</span>\<span class="keyword">frac</span>&#123;y&#125;&#123;x&#125;</span><br><span class="line">       \right)</span><br><span class="line">       \left(u<span class="operator">+</span><span class="number">1</span>\right)</span><br><span class="line">     &#125;<span class="operator">+</span>a</span><br><span class="line">   \right]<span class="operator">^</span>&#123;<span class="number">3</span><span class="operator">/</span><span class="number">2</span>&#125;</span><br><span class="line">\right)</span><br><span class="line">\<span class="keyword">tag</span>&#123;行标&#125;</span><br><span class="line"><span class="operator">$</span><span class="operator">$</span></span><br></pre></td></tr></table></figure>

<ul>
<li>显示：</li>
</ul>
<p>f⎛⎝⎜⎜⎡⎣⎢1+{x,y}(xy+yx)(u+1)+a⎤⎦⎥3&#x2F;2⎞⎠⎟⎟(行标)(行标)f([1+{x,y}(xy+yx)(u+1)+a]3&#x2F;2)</p>
<p>如果你需要在不同的行显示对应括号，可以在每一行对应处使用 <code>\left.</code> 或 <code>\right.</code> 来放一个”影子”括号：</p>
<ul>
<li>例如：</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$$</span></span><br><span class="line">\<span class="keyword">begin</span>&#123;aligned&#125;</span><br><span class="line">a=&amp;\left(<span class="number">1</span>+<span class="number">2</span>+<span class="number">3</span>+  \cdots \right. \\</span><br><span class="line">&amp; \cdots+ \left. \infty-<span class="number">2</span>+\infty-<span class="number">1</span>+\infty\right)</span><br><span class="line">\<span class="keyword">end</span>&#123;aligned&#125;</span><br><span class="line"><span class="variable">$$</span></span><br></pre></td></tr></table></figure>

<ul>
<li>显示：</li>
</ul>
<p>a&#x3D;(1+2+3+⋯⋯+∞−2+∞−1+∞)a&#x3D;(1+2+3+⋯⋯+∞−2+∞−1+∞)</p>
<p>如果你需要将行内显示的分隔符也变大，可以使用 <code>\middle</code> 命令：</p>
<ul>
<li>例如：</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span><span class="variable">$</span></span><br><span class="line">\left\langle  </span><br><span class="line">  q</span><br><span class="line">\middle\|</span><br><span class="line">  \frac&#123;\frac&#123;x&#125;&#123;y&#125;&#125;&#123;\frac&#123;u&#125;&#123;v&#125;&#125;</span><br><span class="line">\middle| </span><br><span class="line">   p </span><br><span class="line">\right\rangle</span><br><span class="line"><span class="variable">$</span><span class="variable">$</span></span><br></pre></td></tr></table></figure>

<ul>
<li>显示：</li>
</ul>
<p>⟨q∥∥∥xyuv∣∣∣p⟩⟨q‖xyuv|p⟩</p>
<h3 id="其它公式"><a href="#其它公式" class="headerlink" title="其它公式"></a>其它公式</h3><h4 id="定义新的符号-operatorname"><a href="#定义新的符号-operatorname" class="headerlink" title="定义新的符号\operatorname"></a>定义新的符号<code>\operatorname</code></h4><p>如：<code>$$ \operatorname&#123;Symbol&#125; A $$</code>，显示： SymbolASymbol⁡A</p>
<h4 id="添加注释文字-text"><a href="#添加注释文字-text" class="headerlink" title="添加注释文字 \text"></a>添加注释文字 <code>\text</code></h4><p>在 <code>\text &#123;文字&#125;</code> 中仍可以使用 <code>$公式$</code> 插入其它公式。</p>
<p>如：<code>$$ f(n)= \begin&#123;cases&#125; n/2, &amp; \text &#123;if $n$ is even&#125; \\ 3n+1, &amp; \text&#123;if $n$ is odd&#125; \end&#123;cases&#125; $$</code></p>
<p>显示：$ f(n)&#x3D; \begin{cases} n&#x2F;2, &amp; \text {if nn is even} \ 3n+1, &amp; \text{if nn is odd} \end{cases} $</p>
<h4 id="在字符间加入空格"><a href="#在字符间加入空格" class="headerlink" title="在字符间加入空格"></a>在字符间加入空格</h4><p>有四种宽度的空格可以使用： <code>\,</code>、<code>\;</code>、<code>\quad</code> 和 <code>\qquad</code> 。</p>
<p>如：<code>$$ a \, b \mid a \; b \mid a \quad b \mid a \qquad b $$</code>,显示：a,b∣a;b∣ab∣aba,b∣a;b∣ab∣ab</p>
<p>当然，使用 <code>\text &#123;n个空格&#125;</code> 也可以达到同样效果。</p>
<h4 id="更改文字颜色"><a href="#更改文字颜色" class="headerlink" title="更改文字颜色"></a>更改文字颜色</h4><p>使用 <code>\color&#123;颜色&#125;&#123;文字&#125;</code> 来更改特定的文字颜色,更改文字颜色 需要浏览器支持，如果浏览器不知道你所需的颜色，那么文字将被渲染为黑色。对于较旧的浏览器（HTML4与CSS2），以下颜色是被支持的：</p>
<table>
<thead>
<tr>
<th align="center">输入</th>
<th align="center">显示</th>
<th align="center">输入</th>
<th align="center">显示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">black</td>
<td align="center">texttext</td>
<td align="center">grey</td>
<td align="center">texttext</td>
</tr>
<tr>
<td align="center">silver</td>
<td align="center">texttext</td>
<td align="center">white</td>
<td align="center">texttext</td>
</tr>
<tr>
<td align="center">maroon</td>
<td align="center">texttext</td>
<td align="center">red</td>
<td align="center">texttext</td>
</tr>
<tr>
<td align="center">yellow</td>
<td align="center">texttext</td>
<td align="center">lime</td>
<td align="center">texttext</td>
</tr>
<tr>
<td align="center">olive</td>
<td align="center">texttext</td>
<td align="center">green</td>
<td align="center">texttext</td>
</tr>
<tr>
<td align="center">teal</td>
<td align="center">texttext</td>
<td align="center">auqa</td>
<td align="center">texttext</td>
</tr>
<tr>
<td align="center">blue</td>
<td align="center">texttext</td>
<td align="center">navy</td>
<td align="center">texttext</td>
</tr>
<tr>
<td align="center">purple</td>
<td align="center">texttext</td>
<td align="center">fuchsia</td>
<td align="center">texttext</td>
</tr>
</tbody></table>
<p>对于较新的浏览器（HTML5与CSS3），额外的124种颜色将被支持：输入 &#96;\color </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2020/05/21/NiD-1.1.1%20perf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/21/NiD-1.1.1%20perf/" class="post-title-link" itemprop="url">Node in Debugging 1.1 Perf + FameGraph</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-21 00:12:31" itemprop="dateCreated datePublished" datetime="2020-05-21T00:12:31-06:00">2020-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Node-in-Debugging/" itemprop="url" rel="index"><span itemprop="name">Node in Debugging</span></a>
        </span>
    </span>

  
    <span id="/2020/05/21/NiD-1.1.1%20perf/" class="post-meta-item leancloud_visitors" data-flag-title="Node in Debugging 1.1 Perf + FameGraph" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging">Node in Debugging</a></p>
<p>当程序出现性能瓶颈时，我们通常通过表象（比如请求某个接口时 CPU 使用率飙涨）然后结合代码去推测可能出问题的地方，却不知道问题到底是什么引起的。如果有个一可视化的工具直观地展现程序的性能瓶颈就好了，幸好 <a target="_blank" rel="noopener" href="http://www.brendangregg.com/">Brendan D. Gregg</a> 发明了火焰图。</p>
<p><a target="_blank" rel="noopener" href="http://www.brendangregg.com/flamegraphs.html">火焰图</a>（Flame Graph）看起来就像一团跳动的火焰，因此得名。火焰图可以将 CPU 的使用情况可视化，使我们直观地了解到程序的性能瓶颈，通常要结合操作系统的性能分析工具（profiling tracer）使用，常见的操作系统的性能分析工具如下：</p>
<ul>
<li>Linux：perf, eBPF, SystemTap, and ktap。</li>
<li>Solaris, illumos, FreeBSD：DTrace。</li>
<li>Mac OS X：DTrace and Instruments。</li>
<li>Windows：Xperf.exe。</li>
</ul>
<h2 id="1-1-1-perf"><a href="#1-1-1-perf" class="headerlink" title="1.1.1 perf"></a>1.1.1 perf</h2><p><a target="_blank" rel="noopener" href="http://www.brendangregg.com/linuxperf.html">perf_events</a>（简称 perf）是 Linux Kernal 自带的系统性能分析工具，能够进行函数级与指令级的热点查找。它基于事件采样原理，以性能事件为基础，支持针对处理器相关性能指标与操作系统相关性能指标的性能剖析，常用于查找性能瓶颈及定位热点代码。</p>
<p>测试机器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line">Linux nswbmw-VirtualBox 4.10.0-28-generic #32~16.04.2-Ubuntu SMP Thu Jul 20 10:19:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：非 Linux 用户需要用虚拟机安装 Ubuntu 16.04 和 <a href="mailto:&#110;&#x6f;&#100;&#101;&#x40;&#x38;&#x2e;&#x39;&#46;&#x34;">&#110;&#x6f;&#100;&#101;&#x40;&#x38;&#x2e;&#x39;&#46;&#x34;</a> 后进行后面的操作。</p>
<p>安装 perf：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install linux-tools-common</span><br><span class="line">$ perf # 根据提示安装对应的内核版本的 tools, 如下</span><br><span class="line">$ sudo apt install linux-tools-4.10.0-28-generic linux-cloud-tools-4.10.0-28-generic</span><br></pre></td></tr></table></figure>

<p>创建测试目录 ~&#x2F;test 和测试代码：</p>
<p><strong>app.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">const crypto = require(&#x27;crypto&#x27;)</span><br><span class="line">const Paloma = require(&#x27;paloma&#x27;)</span><br><span class="line">const app = new Paloma()</span><br><span class="line">const users = &#123;&#125;</span><br><span class="line"></span><br><span class="line">app.route(&#123; method: &#x27;GET&#x27;, path: &#x27;/newUser&#x27;, controller (ctx) &#123;</span><br><span class="line">  const username = ctx.query.username || &#x27;test&#x27;</span><br><span class="line">  const password = ctx.query.password || &#x27;test&#x27;</span><br><span class="line"></span><br><span class="line">  const salt = crypto.randomBytes(128).toString(&#x27;base64&#x27;)</span><br><span class="line">  const hash = crypto.pbkdf2Sync(password, salt, 10000, 64, &#x27;sha512&#x27;).toString(&#x27;hex&#x27;)</span><br><span class="line"></span><br><span class="line">  users[username] = &#123; salt, hash &#125;</span><br><span class="line"></span><br><span class="line">  ctx.status = 204</span><br><span class="line">&#125;&#125;)</span><br><span class="line"></span><br><span class="line">app.route(&#123; method: &#x27;GET&#x27;, path: &#x27;/auth&#x27;, controller (ctx) &#123;</span><br><span class="line">  const username = ctx.query.username || &#x27;test&#x27;</span><br><span class="line">  const password = ctx.query.password || &#x27;test&#x27;</span><br><span class="line"></span><br><span class="line">  if (!users[username]) &#123;</span><br><span class="line">    ctx.throw(400)</span><br><span class="line">  &#125;</span><br><span class="line">  const hash = crypto.pbkdf2Sync(password, users[username].salt, 10000, 64, &#x27;sha512&#x27;).toString(&#x27;hex&#x27;)</span><br><span class="line"></span><br><span class="line">  if (users[username].hash === hash) &#123;</span><br><span class="line">    ctx.status = 204</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    ctx.throw(403)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(3000)</span><br></pre></td></tr></table></figure>

<p>添加 –perf_basic_prof（或者 –perf-basic-prof）参数运行此程序，会对应生成一个 &#x2F;tmp&#x2F;perf-<PID>.map 的文件。命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ node --perf_basic_prof app.js &amp;</span><br><span class="line">[1] 3590</span><br><span class="line">$ tail /tmp/perf-3590.map</span><br><span class="line">51b87a7b93e 18 Function:~emitListeningNT net.js:1375</span><br><span class="line">51b87a7b93e 18 LazyCompile:~emitListeningNT net.js:1375</span><br><span class="line">51b87a7bad6 39 Function:~emitAfterScript async_hooks.js:443</span><br><span class="line">51b87a7bad6 39 LazyCompile:~emitAfterScript async_hooks.js:443</span><br><span class="line">51b87a7bcbe 77 Function:~tickDone internal/process/next_tick.js:88</span><br><span class="line">51b87a7bcbe 77 LazyCompile:~tickDone internal/process/next_tick.js:88</span><br><span class="line">51b87a7bf36 12 Function:~clear internal/process/next_tick.js:42</span><br><span class="line">51b87a7bf36 12 LazyCompile:~clear internal/process/next_tick.js:42</span><br><span class="line">51b87a7c126 b8 Function:~emitPendingUnhandledRejections internal/process/promises.js:86</span><br><span class="line">51b87a7c126 b8 LazyCompile:~emitPendingUnhandledRejections internal/process/promises.js:86</span><br></pre></td></tr></table></figure>

<p><strong>map 文件内容三列依次为</strong>：16进制的符号地址（symbol addresses）、大小（sizes）和符号名（symbol names）。perf 会尝试查找 &#x2F;tmp&#x2F;perf-<PID>.map 文件，用来做符号转换，即把 16 进制的符号地址转换成人能读懂的符号名。</p>
<p><strong>注意</strong>：使用 –perf_basic_prof_only_functions 参数也可以，但经尝试后发现生成的火焰图信息不全（不全的地方显示 [perf-<PID>.map]），所以这里使用 –perf_basic_prof。但是，使用 –perf_basic_prof 有个缺点，就是会导致 map 文件一直增大，这是由于符号（symbols）地址不断变换导致的，用 –perf_basic_prof_only_functions 可以缓解这个问题。关于如何取舍，还请读者自行尝试。</p>
<p>接下来 clone 用来生成火焰图的工具：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone http://github.com/brendangregg/FlameGraph ~/FlameGraph</span><br></pre></td></tr></table></figure>

<p>我们先用 ab 压测：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl &quot;http://localhost:3000/newUser?username=admin&amp;password=123456&quot;</span><br><span class="line">$ ab -k -c 10 -n 2000 &quot;http://localhost:3000/auth?username=admin&amp;password=123456&quot;</span><br></pre></td></tr></table></figure>

<p>新开另一个终端，在 ab 开始压测后立即运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo perf record -F 99 -p 3590 -g -- sleep 30</span><br><span class="line">$ sudo chown root /tmp/perf-3590.map</span><br><span class="line">$ sudo perf script &gt; perf.stacks</span><br><span class="line">$ ~/FlameGraph/stackcollapse-perf.pl --kernel &lt; ~/perf.stacks | ~/FlameGraph/flamegraph.pl --color=js --hash&gt; ~/flamegraph.svg</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：第 1 次生成的 svg 可能不太准确，最好重复几次以上步骤，使用第 2 次及以后生成的 flamegraph.svg。</p>
<p>有几点需要解释一下：</p>
<ul>
<li><p>perf record</p>
<ul>
<li>-F 指定了采样频率 99Hz（即每秒 99 次，如果 99 次都返回同一个函数名，那就说明 CPU 在这一秒钟都在执行同一个函数，可能存在性能问题）。</li>
<li>-p 指定进程的 pid。</li>
<li>-g 启用 call-graph 记录。</li>
<li>– sleep 30 指定记录 30s。</li>
</ul>
</li>
<li><p>sudo chown root &#x2F;tmp&#x2F;perf-3009.map，将 map 文件更改为 root 权限，否则会报如下错误：</p>
<blockquote>
<p>File &#x2F;tmp&#x2F;perf-PID.map not owned by current user or root, ignoring it (use -f to override). Failed to open &#x2F;tmp&#x2F;perf-PID.map, continuing without symbols</p>
</blockquote>
</li>
<li><p>perf record 会将记录的信息保存到当前执行目录的 perf.data 文件中，然后使用 perf script 读取 perf.data 的 trace 信息写入 perf.stacks。</p>
</li>
<li><p>–color&#x3D;js 指定生成针对 JavaScript 配色的 svg，即：</p>
<ul>
<li>green：JavaScript。</li>
<li>blue：Builtin。</li>
<li>yellow：C++。</li>
<li>red：System（native user-level, and kernel）。</li>
</ul>
</li>
</ul>
<p>ab 压测用了 30s 左右，用浏览器打开 flamegraph.svg，截取关键的部分如下图所示： <a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging/blob/master/assets/1.1.1.png"><img src="https://github.com/nswbmw/node-in-debugging/raw/master/assets/1.1.1.png" alt="img"></a></p>
<h2 id="1-1-2-理解火焰图"><a href="#1-1-2-理解火焰图" class="headerlink" title="1.1.2 理解火焰图"></a>1.1.2 理解火焰图</h2><p>火焰图含义：</p>
<ul>
<li>每一个小块代表了一个函数在栈中的位置（即一个栈帧）。</li>
<li>Y 轴代表栈的深度（栈上的帧数），顶端的小块显示了占据 CPU 的函数。每个小块的下面是它的祖先（即父函数）。</li>
<li>X 轴代表总的样例群体。它不像绝大多数图表那样从左到右表示时间的流逝，其左右顺序没有特殊含义，仅仅按照字母表的顺序排列。</li>
<li>小块的宽度代表 CPU 的使用时间，或者说相对于父函数而言使用 CPU 的比例（基于所有样例），越宽则代表占用 CPU 的时间越长，或者使用 CPU 很频繁。</li>
<li>如果采取多线程并发运行取样，则取样数量会超过运行时间。</li>
</ul>
<p><strong>从上图可以看出</strong>：最上面的绿色小块（即 JavaScript 代码）指向 test&#x2F;app.js 第 18 行，即 <code>GET /auth</code> 这个路由。再往上看，黄色的小块（即 C++ 代码） node::crypto::PBKDF2 占用了大量的 CPU 时间。</p>
<p><strong>解决方法</strong>：将同步改为异步，即将 crypto.pbkdf2Sync 改为 crypto.pbkdf2。修改如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">app.route(&#123; method: &#x27;GET&#x27;, path: &#x27;/auth&#x27;, async controller (ctx) &#123;</span><br><span class="line">  const username = ctx.query.username || &#x27;test&#x27;</span><br><span class="line">  const password = ctx.query.password || &#x27;test&#x27;</span><br><span class="line"></span><br><span class="line">  if (!users[username]) &#123;</span><br><span class="line">    ctx.throw(400)</span><br><span class="line">  &#125;</span><br><span class="line">  const hash = await new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    crypto.pbkdf2(password, users[username].salt, 10000, 64, &#x27;sha512&#x27;, (err, derivedKey) =&gt; &#123;</span><br><span class="line">      if (err) &#123;</span><br><span class="line">        return reject(err)</span><br><span class="line">      &#125;</span><br><span class="line">      resolve(derivedKey.toString(&#x27;hex&#x27;))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  if (users[username].hash === hash) &#123;</span><br><span class="line">    ctx.status = 204</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    ctx.throw(403)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>用 ab 重新压测，结果用了 16s。重新生成的火焰图如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging/blob/master/assets/1.1.2.png"><img src="https://github.com/nswbmw/node-in-debugging/raw/master/assets/1.1.2.png" alt="img"></a></p>
<p><strong>可以看出</strong>：只有在左侧极窄的绿色小块可以看到 JavaScript 代码，红色的部分我们不关心也无法优化。那么，为什么异步比同步的 QPS 要高呢？原因是 Node.js 底层的 libuv 用了多个线程进行计算，这里就不再深入介绍了。</p>
<p>svg 火焰图的其他小技巧如下：</p>
<ol>
<li>单击任意一个小块即可展开，即被单击的小块宽度变宽，它的子函数也按比例变宽，方便查看。</li>
<li>可单击 svg 右上角的 search 按钮进行搜索，被搜索的关键词会高亮显示，在有目的地查找某个函数时比较有用。</li>
</ol>
<h2 id="1-1-3-红蓝差分火焰图"><a href="#1-1-3-红蓝差分火焰图" class="headerlink" title="1.1.3 红蓝差分火焰图"></a>1.1.3 红蓝差分火焰图</h2><p>虽然我们有了火焰图，但要处理性能回退问题，还需要在修改代码前后的火焰图之间，不断切换和对比，来找出问题所在，很不方便。于是 <a target="_blank" rel="noopener" href="http://www.brendangregg.com/index.html">Brendan D. Gregg</a> 又发明了红蓝差分火焰图（Red&#x2F;Blue Differential Flame Graphs）。</p>
<p><strong>如下所示</strong>：红色表示增长，蓝色表示衰减。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging/blob/master/assets/1.1.3.jpg"><img src="https://github.com/nswbmw/node-in-debugging/raw/master/assets/1.1.3.jpg" alt="img"></a></p>
<p>红蓝差分火焰图的工作原理如下：</p>
<ol>
<li>抓取修改前的栈 profile1 文件。</li>
<li>抓取修改后的栈 profile2 文件。</li>
<li>使用 profile2 来生成火焰图，这样栈帧的宽度就是以 profile2 文件为基准的。</li>
<li>使用 profile2 - profile1 的差异来对火焰图重新上色。上色的原则是：如果栈帧在 profile2 中出现出现的次数更多，则标为红色，否则标为蓝色。色彩是根据修改前后的差异来填充的。</li>
</ol>
<p>这样，通过红蓝差分火焰图，我们就可以清楚地看到系统性能的差异之处。</p>
<p>生成红蓝差分火焰图的流程如下：</p>
<ol>
<li><p>修改代码前运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo perf record -F 99 -p &lt;PID&gt; -g -- sleep 30</span><br><span class="line">$ sudo chown root /tmp/perf-&lt;PID&gt;.map</span><br><span class="line">$ sudo perf script &gt; perf_before.stacks</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改代码后运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo perf record -F 99 -p &lt;PID&gt; -g -- sleep 30</span><br><span class="line">$ sudo chown root /tmp/perf-&lt;PID&gt;.map</span><br><span class="line">$ sudo perf script &gt; perf_after.stacks</span><br></pre></td></tr></table></figure>
</li>
<li><p>将 profile 文件进行折叠（fold），然后生成差分火焰图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ~/FlameGraph/stackcollapse-perf.pl ~/perf_before.stacks &gt; perf_before.folded</span><br><span class="line">$ ~/FlameGraph/stackcollapse-perf.pl ~/perf_after.stacks &gt; perf_after.folded</span><br><span class="line">$ ./FlameGraph/difffolded.pl perf_before.folded perf_after.folded | ./FlameGraph/flamegraph.pl &gt; flamegraph_diff.svg</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>如上缺点是</strong>：如果一个代码执行路径完全消失了，那么在火焰图中就找不到地方来标注蓝色，我们只能看到当前的 CPU 使用情况，却不知道为什么会变成这样。</p>
<p>一种解决办法是：生成一个相反的差分火焰图，即基于 profile1 生成 profile1 - profile2 的差分火焰图。对应命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./FlameGraph/difffolded.pl perf_after.folded perf_before.folded | ./FlameGraph/flamegraph.pl --negate &gt; flamegraph_diff2.svg</span><br></pre></td></tr></table></figure>

<p>其中，–negate 用于颠倒红&#x2F;蓝配色。最终我们得到：</p>
<ul>
<li>flamegraph_diff.svg：宽度是以修改前的 profile 文件为基准，颜色表明将要发生的情况。</li>
<li>flamegraph_diff2.svg：宽度是以修改后的 profile 文件为基准，颜色表明已经发生的情况。</li>
</ul>
<p>总之，红蓝差分火焰图可能只在代码变化不大的情况下使用时效果明显，在代码变化较大的情况下使用时效果可能就不明显了。</p>
<h2 id="1-1-4-参考链接"><a href="#1-1-4-参考链接" class="headerlink" title="1.1.4 参考链接"></a>1.1.4 参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://yunong.io/2015/11/23/generating-node-js-flame-graphs/">https://yunong.io/2015/11/23/generating-node-js-flame-graphs/</a></li>
<li><a target="_blank" rel="noopener" href="http://www.brendangregg.com/perf.html">http://www.brendangregg.com/perf.html</a></li>
<li><a target="_blank" rel="noopener" href="http://www.brendangregg.com/blog/2014-09-17/node-flame-graphs-on-linux.html">http://www.brendangregg.com/blog/2014-09-17/node-flame-graphs-on-linux.html</a></li>
<li><a target="_blank" rel="noopener" href="https://linux.cn/article-4670-1.html">https://linux.cn/article-4670-1.html</a></li>
<li><a target="_blank" rel="noopener" href="http://www.brendangregg.com/blog/2014-11-09/differential-flame-graphs.html">http://www.brendangregg.com/blog/2014-11-09/differential-flame-graphs.html</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2017/09/flame-graph.html">http://www.ruanyifeng.com/blog/2017/09/flame-graph.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2020/05/21/NiD-1.3.1%20Tick%20Processor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/21/NiD-1.3.1%20Tick%20Processor/" class="post-title-link" itemprop="url">Node in Debugging 1.3 Tick Processor</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-21 00:12:31" itemprop="dateCreated datePublished" datetime="2020-05-21T00:12:31-06:00">2020-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Node-in-Debugging/" itemprop="url" rel="index"><span itemprop="name">Node in Debugging</span></a>
        </span>
    </span>

  
    <span id="/2020/05/21/NiD-1.3.1%20Tick%20Processor/" class="post-meta-item leancloud_visitors" data-flag-title="Node in Debugging 1.3 Tick Processor" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging">Node in Debugging</a></p>
<p>V8 内置了一个性能分析工具——Tick Processor，可以记录 JavaScript&#x2F;C&#x2F;C++ 代码的堆栈信息，该功能默认是关闭的，可以通过添加命令行参数 <code>--prof</code> 开启。</p>
<h2 id="1-3-1-Tick-Processor"><a href="#1-3-1-Tick-Processor" class="headerlink" title="1.3.1 Tick Processor"></a>1.3.1 Tick Processor</h2><p>创建测试代码：</p>
<p><strong>app.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const crypto = require(&#x27;crypto&#x27;)</span><br><span class="line"></span><br><span class="line">function hash (password) &#123;</span><br><span class="line">  const salt = crypto.randomBytes(128).toString(&#x27;base64&#x27;)</span><br><span class="line">  const hash = crypto.pbkdf2Sync(password, salt, 10000, 64, &#x27;sha512&#x27;)</span><br><span class="line">  return hash</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.time(&#x27;pbkdf2Sync&#x27;)</span><br><span class="line">for (let i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">  hash(&#x27;random_password&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">console.timeEnd(&#x27;pbkdf2Sync&#x27;)</span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node --prof app</span><br><span class="line">pbkdf2Sync: 1375.582ms</span><br></pre></td></tr></table></figure>

<p>可以看出，执行 100 次 hash 函数总共用了 1375.585ms，并且当前目录下多了一个 isolate-xxx-v8.log 文件，该文件记录了 V8 的性能日志，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v8-version,6,1,534,50,0</span><br><span class="line">shared-library,&quot;/usr/local/bin/node&quot;,0x100001800,0x100bbb69a,0</span><br><span class="line">...</span><br><span class="line">code-creation,Function,18,111912,0x37d07c7246a8,144,&quot;hash /Users/nswbmw/Desktop/test/app.js:3:15&quot;,0x37d07c7076d0,~</span><br><span class="line">code-creation,LazyCompile,18,111927,0x37d07c7246a8,144,&quot;hash /Users/nswbmw/Desktop/test/app.js:3:15&quot;,0x37d07c7076d0,~</span><br><span class="line">code-creation,Function,18,112058,0x37d07c725690,80,&quot;exports.pbkdf2Sync crypto.js:686:30&quot;,0x37d07c70cb58,~</span><br><span class="line">code-creation,LazyCompile,18,112074,0x37d07c725690,80,&quot;exports.pbkdf2Sync crypto.js:686:30&quot;,0x37d07c70cb58,~</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>早期我们需要借助 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/node-tick-processor">node-tick-processor</a> 这样的工具解析 v8.log，但 Node.js 在 v5.2.0 之后包含了 v8.log 处理器，添加命令行参数 <code>--prof-process</code> 开启。</p>
<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node --prof-process isolate-0x103000000-v8.log</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Statistical profiling result from isolate-0x103000000-v8.log, (1152 ticks, 44 unaccounted, 0 excluded).</span><br><span class="line"></span><br><span class="line"> [Shared libraries]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line"></span><br><span class="line"> [JavaScript]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line">      1    0.1%    0.1%  Function: ~Uint8Array native typedarray.js:158:31</span><br><span class="line">      1    0.1%    0.1%  Function: ~NativeModule.cache bootstrap_node.js:604:42</span><br><span class="line">      1    0.1%    0.1%  Function: ~Buffer.toString buffer.js:609:37</span><br><span class="line"></span><br><span class="line"> [C++]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line">   1023   88.8%   88.8%  T node::crypto::PBKDF2(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;)</span><br><span class="line">     27    2.3%    2.3%  t node::(anonymous namespace)::ContextifyScript::New(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;)</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line"> [Summary]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line">      3    0.3%    0.3%  JavaScript</span><br><span class="line">   1105   95.9%   95.9%  C++</span><br><span class="line">      3    0.3%    0.3%  GC</span><br><span class="line">      0    0.0%          Shared libraries</span><br><span class="line">     44    3.8%          Unaccounted</span><br><span class="line"></span><br><span class="line"> [C++ entry points]:</span><br><span class="line">   ticks    cpp   total   name</span><br><span class="line">   1062   98.2%   92.2%  T v8::internal::Builtin_HandleApiCall(int, v8::internal::Object**, v8::internal::Isolate*)</span><br><span class="line">     13    1.2%    1.1%  T v8::internal::Runtime_CompileLazy(int, v8::internal::Object**, v8::internal::Isolate*)</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line"> [Bottom up (heavy) profile]:</span><br><span class="line">  Note: percentage shows a share of a particular caller in the total</span><br><span class="line">  amount of its parent calls.</span><br><span class="line">  Callers occupying less than 1.0% are not shown.</span><br><span class="line"></span><br><span class="line">   ticks parent  name</span><br><span class="line">   1023   88.8%  T node::crypto::PBKDF2(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;)</span><br><span class="line">   1023  100.0%    T v8::internal::Builtin_HandleApiCall(int, v8::internal::Object**, v8::internal::Isolate*)</span><br><span class="line">   1023  100.0%      Function: ~pbkdf2 crypto.js:691:16</span><br><span class="line">   1023  100.0%        Function: ~exports.pbkdf2Sync crypto.js:686:30</span><br><span class="line">   1023  100.0%          Function: ~hash /Users/nswbmw/Desktop/test/app.js:3:15</span><br><span class="line">   1023  100.0%            Function: ~&lt;anonymous&gt; /Users/nswbmw/Desktop/test/app.js:1:11</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>

<p>打印结果包含六部分：Shared libraries、JavaScript、C++、Summary、C++ entry points 和 Bottom up (heavy) profile。[JavaScript] 部分列出了 JavaScript 代码执行所占用的 CPU ticks（CPU 时钟周期），[C++] 部分列出了 C++ 代码执行所占用的 CPU ticks，[Summary] 列出了各个部分的占比，[Bottom up] 列出了所有 CPU 占用时间从大到小的函数及堆栈信息，小于 1% 的则不予显示。</p>
<p><strong>可以看出</strong>：88.8%的 CPU 时间都花在了 crypto.js 文件的 pbkdf2Sync 函数上，该函数在 app.js 第 3 行被调用，即我们的 hash 函数。</p>
<p><strong>解决方法</strong>：将同步的 pbkdf2Sync 改为异步的 pbkdf2。修改代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const crypto = require(&#x27;crypto&#x27;)</span><br><span class="line"></span><br><span class="line">function hash (password, cb) &#123;</span><br><span class="line">  const salt = crypto.randomBytes(128).toString(&#x27;base64&#x27;)</span><br><span class="line">  crypto.pbkdf2(password, salt, 10000, 64, &#x27;sha512&#x27;, cb)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let count = 0</span><br><span class="line">console.time(&#x27;pbkdf2&#x27;)</span><br><span class="line">for (let i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">  hash(&#x27;random_password&#x27;, () =&gt; &#123;</span><br><span class="line">    count++</span><br><span class="line">    if (count === 100) &#123;</span><br><span class="line">      console.timeEnd(&#x27;pbkdf2&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node --prof app</span><br><span class="line">pbkdf2: 656.332ms</span><br></pre></td></tr></table></figure>

<p>可以看出，程序运行了 656.332ms，相比较于之前的 1375.585ms，性能提升了 1 倍。我们继续看下 v8.log 的分析结果，运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ node --prof-process isolate-0x102802400-v8.log</span><br><span class="line">Statistical profiling result from isolate-0x103001a00-v8.log, (198 ticks, 19 unaccounted, 0 excluded).</span><br><span class="line"></span><br><span class="line"> [Shared libraries]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line"></span><br><span class="line"> [JavaScript]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line">      1    0.5%    0.5%  StoreIC: A store IC from the snapshot</span><br><span class="line">      1    0.5%    0.5%  Function: ~set native collection.js:149:4</span><br><span class="line">      1    0.5%    0.5%  Function: ~pbkdf2 crypto.js:691:16</span><br><span class="line">      1    0.5%    0.5%  Function: ~inherits util.js:962:18</span><br><span class="line">      1    0.5%    0.5%  Builtin: ArrayIteratorPrototypeNext</span><br><span class="line"></span><br><span class="line"> [C++]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line">     83   41.9%   41.9%  T ___kdebug_trace_string</span><br><span class="line">     31   15.7%   15.7%  t node::(anonymous namespace)::ContextifyScript::New(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;)</span><br><span class="line">     14    7.1%    7.1%  T ___pthread_sigmask</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line"> [Summary]:</span><br><span class="line">   ticks  total  nonlib   name</span><br><span class="line">      5    2.5%    2.5%  JavaScript</span><br><span class="line">    174   87.9%   87.9%  C++</span><br><span class="line">      3    1.5%    1.5%  GC</span><br><span class="line">      0    0.0%          Shared libraries</span><br><span class="line">     19    9.6%          Unaccounted</span><br><span class="line"></span><br><span class="line"> [C++ entry points]:</span><br><span class="line">   ticks    cpp   total   name</span><br><span class="line">     41   60.3%   20.7%  T v8::internal::Builtin_HandleApiCall(int, v8::internal::Object**, v8::internal::Isolate*)</span><br><span class="line">     17   25.0%    8.6%  T v8::internal::Runtime_CompileLazy(int, v8::internal::Object**, v8::internal::Isolate*)</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line"> [Bottom up (heavy) profile]:</span><br><span class="line">  Note: percentage shows a share of a particular caller in the total</span><br><span class="line">  amount of its parent calls.</span><br><span class="line">  Callers occupying less than 1.0% are not shown.</span><br><span class="line"></span><br><span class="line">   ticks parent  name</span><br><span class="line">     83   41.9%  T ___kdebug_trace_string</span><br><span class="line"></span><br><span class="line">     31   15.7%  t node::(anonymous namespace)::ContextifyScript::New(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;)</span><br><span class="line">     31  100.0%    T v8::internal::Builtin_HandleApiCall(int, v8::internal::Object**, v8::internal::Isolate*)</span><br><span class="line">     31  100.0%      Function: ~runInThisContext bootstrap_node.js:495:28</span><br><span class="line">     31  100.0%        Function: ~NativeModule.compile bootstrap_node.js:584:44</span><br><span class="line">     31  100.0%          Function: ~NativeModule.require bootstrap_node.js:516:34</span><br><span class="line">     ...</span><br></pre></td></tr></table></figure>

<p>可以看出，[Bottom up] 没有很多 ticks，而且不再有 pbkdf2 这种堆栈信息。</p>
<h2 id="1-3-2-Web-UI"><a href="#1-3-2-Web-UI" class="headerlink" title="1.3.2 Web UI"></a>1.3.2 Web UI</h2><p>V8 还提供了一个 Web 可视化工具来查看生成的 v8 日志。首先，将代码还原到使用 pbkdf2Sync 的版本，运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node --prof app # 生成 isolate-0x103000000-v8.log</span><br><span class="line">$ node --prof-process --preprocess isolate-0x103000000-v8.log &gt; v8.json # 格式化成 JSON 文件</span><br><span class="line">$ git clone https://github.com/v8/v8.git # 克隆 v8 仓库</span><br><span class="line">$ open v8/tools/profview/index.html # 打开 V8 profiling log processor</span><br></pre></td></tr></table></figure>

<p>点击 “选择文件”，选择刚才生成的 v8.json 文件，点击 “Bottom up” 视图，如下所示：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging/blob/master/assets/1.3.1.png"><img src="https://github.com/nswbmw/node-in-debugging/raw/master/assets/1.3.1.png" alt="img"></a></p>
<p>有以下两点需要解释：</p>
<ol>
<li>图中的上半部分展示了 CPU 的 timeline，X 轴代表时间的流逝，Y 轴代表当前时间点不同部分占用 CPU 的比例，可以在 timeline 图表上单击左键不放，然后拖动，选择时间区间。</li>
<li>图中的下半部分展示了当前时间段内 CPU 占用比从大到小降序排列的函数，展开可查看堆栈信息。不同的颜色代表了不同的部分，点击任意一个函数，timeline 底部会展示该函数的执行时间分布。</li>
</ol>
<h2 id="1-3-3-参考链接"><a href="#1-3-3-参考链接" class="headerlink" title="1.3.3 参考链接"></a>1.3.3 参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/v8/v8/wiki/V8-Profiler">https://github.com/v8/v8/wiki/V8-Profiler</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.ghaiklor.com/profiling-nodejs-applications-1609b77afe4e">https://blog.ghaiklor.com/profiling-nodejs-applications-1609b77afe4e</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/23934451/how-to-read-nodejs-internal-profiler-tick-processor-output">https://stackoverflow.com/questions/23934451/how-to-read-nodejs-internal-profiler-tick-processor-output</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2020/05/21/Nid-1.2.1%20%E4%BD%BF%E7%94%A8%20v8-profiler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/21/Nid-1.2.1%20%E4%BD%BF%E7%94%A8%20v8-profiler/" class="post-title-link" itemprop="url">Node in Debugging 1.2 使用 v8-profiler</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-21 00:12:31" itemprop="dateCreated datePublished" datetime="2020-05-21T00:12:31-06:00">2020-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Node-in-Debugging/" itemprop="url" rel="index"><span itemprop="name">Node in Debugging</span></a>
        </span>
    </span>

  
    <span id="/2020/05/21/Nid-1.2.1%20%E4%BD%BF%E7%94%A8%20v8-profiler/" class="post-meta-item leancloud_visitors" data-flag-title="Node in Debugging 1.2 使用 v8-profiler" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging">Node in Debugging</a></p>
<p>我们知道 Node.js 是基于 V8 引擎的，V8 暴露了一些 profiler API，我们可以通过 <a target="_blank" rel="noopener" href="https://github.com/node-inspector/v8-profiler">v8-profiler</a> 收集一些运行时数据（例如：CPU 和内存）。本节将介绍如何使用 v8-profiler 分析 CPU 的使用情况。</p>
<h2 id="1-2-1-使用-v8-profiler"><a href="#1-2-1-使用-v8-profiler" class="headerlink" title="1.2.1 使用 v8-profiler"></a>1.2.1 使用 v8-profiler</h2><p>创建测试代码：</p>
<p><strong>app.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line">const crypto = require(&#x27;crypto&#x27;)</span><br><span class="line">const Bluebird = require(&#x27;bluebird&#x27;)</span><br><span class="line">const profiler = require(&#x27;v8-profiler&#x27;)</span><br><span class="line">const Paloma = require(&#x27;paloma&#x27;)</span><br><span class="line">const app = new Paloma()</span><br><span class="line"></span><br><span class="line">app.route(&#123; method: &#x27;GET&#x27;, path: &#x27;/encrypt&#x27;, controller: function encryptRouter (ctx) &#123;</span><br><span class="line">  const password = ctx.query.password || &#x27;test&#x27;</span><br><span class="line">  const salt = crypto.randomBytes(128).toString(&#x27;base64&#x27;)</span><br><span class="line">  const encryptedPassword = crypto.pbkdf2Sync(password, salt, 10000, 64, &#x27;sha512&#x27;).toString(&#x27;hex&#x27;)</span><br><span class="line"></span><br><span class="line">  ctx.body = encryptedPassword</span><br><span class="line">&#125;&#125;)</span><br><span class="line"></span><br><span class="line">app.route(&#123; method: &#x27;GET&#x27;, path: &#x27;/cpuprofile&#x27;, async controller (ctx) &#123;</span><br><span class="line">   //Start Profiling</span><br><span class="line">   profiler.startProfiling(&#x27;CPU profile&#x27;)</span><br><span class="line">   await Bluebird.delay(30000)</span><br><span class="line">   //Stop Profiling after 30s</span><br><span class="line">   const profile = profiler.stopProfiling()</span><br><span class="line">   profile.export()</span><br><span class="line">     .pipe(fs.createWriteStream(`cpuprofile-$&#123;Date.now()&#125;.cpuprofile`))</span><br><span class="line">     .on(&#x27;finish&#x27;, () =&gt; profile.delete())</span><br><span class="line">   ctx.status = 204</span><br><span class="line">&#125;&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(3000)</span><br></pre></td></tr></table></figure>

<p><code>GET /encrypt</code> 有一个 CPU 密集型的计算函数 crypto.pbkdf2Sync，<code>GET /cpuprofile</code> 用来收集 30s 的 V8 log 然后将其 dump 到一个文件中。</p>
<p>运行该程序，打开两个终端窗口。一个终端运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:3000/cpuprofile</span><br></pre></td></tr></table></figure>

<p>来触发 CPU profiling，然后另一个终端立即运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ab -c 20 -n 2000 &quot;http://localhost:3000/encrypt?password=123456&quot;</span><br></pre></td></tr></table></figure>

<p>来触发 CPU 密集计算。</p>
<p>最后生成 cpuprofile-xxx.cpuprofile 文件，该文件的内容其实就是一个大的 JSON 对象，大体如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;typeId&quot;: &quot;CPU&quot;,</span><br><span class="line">  &quot;uid&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;CPU profile&quot;,</span><br><span class="line">  &quot;head&quot;:</span><br><span class="line">   &#123; &quot;functionName&quot;: &quot;(root)&quot;,</span><br><span class="line">     &quot;url&quot;: &quot;&quot;,</span><br><span class="line">     &quot;lineNumber&quot;: 0,</span><br><span class="line">     &quot;callUID&quot;: 154,</span><br><span class="line">     &quot;bailoutReason&quot;: &quot;&quot;,</span><br><span class="line">     &quot;id&quot;: 1,</span><br><span class="line">     &quot;scriptId&quot;: 0,</span><br><span class="line">     &quot;hitCount&quot;: 0,</span><br><span class="line">     &quot;children&quot;: [ ... ] &#125;,</span><br><span class="line">  &quot;startTime&quot;: 276245,</span><br><span class="line">  &quot;endTime&quot;: 276306,</span><br><span class="line">  &quot;samples&quot;: [ ... ],</span><br><span class="line">  &quot;timestamps&quot;: [ ... ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个 JSON 对象记录了函数调用栈、路径、时间戳和一些其他信息，samples 节点数组与 timestamps 节点数组中的时间戳是一一对应的，并且 samples 节点数组中的每一个值其实对应了 head 节点的深度优先遍历 ID。这里我们不深究每个字段的含义，先来看看如何可视化这些数据。</p>
<h2 id="1-2-2-方法-1——Chrome-DevTools"><a href="#1-2-2-方法-1——Chrome-DevTools" class="headerlink" title="1.2.2 方法 1——Chrome DevTools"></a>1.2.2 方法 1——Chrome DevTools</h2><p>Chrome 自带了分析 CPU profile 日志的工具。打开 Chrome -&gt; 调出开发者工具（DevTools） -&gt; 单击右上角三个点的按钮 -&gt; More tools -&gt; JavaScript Profiler -&gt; Load，加载刚才生成的 cpuprofile 文件。左上角的下拉菜单可以选择如下三种模式：</p>
<ol>
<li>Chart：显示按时间顺序排列的火焰图。</li>
<li>Heavy (Bottom Up)：按照函数对性能的影响排列，同时可以检查函数的调用路径。</li>
<li>Tree (Top Down)：显示调用结构的总体状况，从调用堆栈的顶端开始。</li>
</ol>
<p>这里我们选择 Tree (Top Down) 模式，按 Total Time 降序排列。可以看到有如下三列：</p>
<ol>
<li>Self Time：函数调用所耗费的时间，仅包含函数本身的声明，不包含任何子函数的执行时间。</li>
<li>Total Time：函数调用所耗费的总时间，包含函数本身的声明及所有子函数执行时间。即：父函数的 Total Time &#x3D; 父函数的 Self Time + 所有子函数的 Total Time。</li>
<li>Function：函数名及路径，可展开查看子函数。</li>
</ol>
<p>我们不断地展开，并定位到了 encryptRouter，如下图所示：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging/blob/master/assets/1.2.1.png"><img src="https://github.com/nswbmw/node-in-debugging/raw/master/assets/1.2.1.png" alt="img"></a></p>
<p><strong>可以看出</strong>：我们定位到了 encryptRouter 这个路由，并且这个路由中 exports.pbkdf2Sync 占据了绝大部分 CPU 时间。</p>
<h2 id="1-2-3-方法-2——火焰图"><a href="#1-2-3-方法-2——火焰图" class="headerlink" title="1.2.3 方法 2——火焰图"></a>1.2.3 方法 2——火焰图</h2><p>我们也可以用火焰图来展示 cpuprofile 数据。首先全局安装 flamegraph 模块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i flamegraph -g</span><br></pre></td></tr></table></figure>

<p>运行以下命令将 cpuprofile 文件生成 svg 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ flamegraph -t cpuprofile -f cpuprofile-xxx.cpuprofile -o cpuprofile.svg</span><br></pre></td></tr></table></figure>

<p>用浏览器打开 cpuprofile.svg，如下所示：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging/blob/master/assets/1.2.2.png"><img src="https://github.com/nswbmw/node-in-debugging/raw/master/assets/1.2.2.png" alt="img"></a></p>
<p><strong>可以看出</strong>：我们定位到了 app.js 的第 8 行，即 encryptRouter 这个路由，并且这个路由中 exports.pbkdf2Sync 占据了绝大部分 CPU 时间。</p>
<h2 id="1-2-4-方法-3——v8-analytics"><a href="#1-2-4-方法-3——v8-analytics" class="headerlink" title="1.2.4 方法 3——v8-analytics"></a>1.2.4 方法 3——v8-analytics</h2><p><a target="_blank" rel="noopener" href="https://github.com/hyj1991/v8-analytics">v8-analytics</a> 是社区开源的一个解析 v8-profiler 和 heapdump 等模块生成的 CPU 和 heap-memory 日志的工具。它提供以下功能：</p>
<ul>
<li>将 V8 引擎逆优化或者优化失败的函数标红展示，并展示优化失败的原因。</li>
<li>在函数执行时长超过预期时标红展示。</li>
<li>展示当前项目中可疑的内存泄漏点。</li>
</ul>
<p>我们以上述第 2 个功能为例，使用 v8-analytics 分析 CPU 的使用情况。</p>
<p>首先，全局安装 v8-analytics：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i v8-analytics -g</span><br></pre></td></tr></table></figure>

<p>使用以下命令查看执行时间大于 200ms 的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ va timeout cpuprofile-xxx.cpuprofile 200 --only</span><br></pre></td></tr></table></figure>

<p>结果截图如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nswbmw/node-in-debugging/blob/master/assets/1.2.3.png"><img src="https://github.com/nswbmw/node-in-debugging/raw/master/assets/1.2.3.png" alt="img"></a></p>
<p><strong>可以看出</strong>：我们依然能够定位到 encryptRouter 和 exports.pbkdf2Sync。</p>
<h2 id="1-2-5-参考链接"><a href="#1-2-5-参考链接" class="headerlink" title="1.2.5 参考链接"></a>1.2.5 参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developers.google.com/web/tools/chrome-devtools/rendering-tools/js-execution">https://developers.google.com/web/tools/chrome-devtools/rendering-tools/js-execution</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ebaytechblog.com/2016/06/15/igniting-node-js-flames/">http://www.ebaytechblog.com/2016/06/15/igniting-node-js-flames/</a></li>
<li><a target="_blank" rel="noopener" href="https://cnodejs.org/topic/58b562f97872ea0864fee1a7">https://cnodejs.org/topic/58b562f97872ea0864fee1a7</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hyj1991/v8-analytics/blob/master/README_ZH.md">https://github.com/hyj1991/v8-analytics/blob/master/README_ZH.md</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2020/05/21/Nuxtjs%20%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/21/Nuxtjs%20%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Nuxt.js 基础入门教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-21 00:12:31" itemprop="dateCreated datePublished" datetime="2020-05-21T00:12:31-06:00">2020-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nuxt/" itemprop="url" rel="index"><span itemprop="name">Nuxt</span></a>
        </span>
    </span>

  
    <span id="/2020/05/21/Nuxtjs%20%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Nuxt.js 基础入门教程" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=yQ8lENTmwnYOjAcdGWYdHg==.qBZchJpLuLMLzRDxyeXVf6UVQ25JAxbNuYLPFEPnro/p541xocWwP+kE4eVkOX6oSsfN8k4d1lqwyg1sByVw+w==">原文链接</a></p>
<p>Vue 开发一个单页面应用，相信很多前端工程师都已经学会了，但是单页面应用有一个致命的缺点，就是 SEO 极不友好。除非，vue 能在服务端渲染（ssr）并直接返回已经渲染好的页面，而并非只是一个单纯的 <code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>。</p>
<p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=oKAZXiPKJ8/UBeXAg0oxiQ==.6cm3QKXDeEFzjZvUTIl8ZIVO9VzX9U3Ie/L9nEcOVTg=">Nuxt.js</a> 就是一个极简的 vue 版的 ssr 框架。基于它，我们可以快速开发一个基于 vue 的 ssr 单页面应用。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>Nuxt.js 官方提供了一个模板，可以使用 vue-cli 直接安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vue init nuxt-community/starter-template &lt;project-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README<span class="selector-class">.md</span></span><br><span class="line">├── assets</span><br><span class="line">├── components</span><br><span class="line">├── layouts</span><br><span class="line">├── middleware</span><br><span class="line">├── node_modules</span><br><span class="line">├── nuxt<span class="selector-class">.config</span><span class="selector-class">.js</span></span><br><span class="line">├── package<span class="selector-class">.json</span></span><br><span class="line">├── pages</span><br><span class="line">├── plugins</span><br><span class="line">├── static</span><br><span class="line">├── store</span><br><span class="line">└── yarn.lock</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ol>
<li><strong>assets</strong>: 资源文件。放置需要经过 webpack 打包处理的资源文件，如 scss，图片，字体等。</li>
<li><strong>components</strong>: 组件。这里存放在页面中，可以复用的组件。</li>
<li><strong>layouts</strong>: 布局。页面都需要有一个布局，默认为 default。它规定了一个页面如何布局页面。所有页面都会加载在布局页面中的 <code>&lt;nuxt /&gt;</code> 标签中。如果需要在普通页面中使用下级路由，则需要在页面中添加 <code>&lt;nuxt-child /&gt;</code>。<strong>该目录名为Nuxt.js保留的，不可更改。</strong></li>
<li><strong>middleware</strong>: 中间件。存放中间件。可以在页面中调用： <code>middleware: &#39;middlewareName&#39;</code> 。</li>
<li><strong>pages</strong>: 页面。一个 vue 文件即为一个页面。index.vue 为根页面。<ol>
<li>若需要二级页面，则添加文件夹即可。</li>
<li>如果页面的名称类似于 <code>_id.vue</code> （以 <code>_</code> 开头），则为动态路由页面，<code>_</code> 后为匹配的变量（params）。</li>
<li>若变量是必须的，则在文件夹下建立空文件 <code>index.vue</code>。更多的配置请移步至 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=dqP8fiwxvWcDQejYsgVfnQ==.y26NO9RNGsx08RI8Gi7Imhg7B3G7QLbeJXY0U4CsVIHZ9YnGGZLnh+xUVeE0oWah">官网</a> 。</li>
</ol>
</li>
<li><strong>plugin</strong>: 插件。用于组织那些需要在 <code>根vue.js应用</code> 实例化之前需要运行的 Javascript 插件。<strong>需要注意的是，在任何 Vue 组件的<a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=CuYf1e6VrH3SxMCC649nww==.QcZmNcZIQPcT+7faNXV4O9TUsr6jlU05cNgm73fDzNVi1aqdlnZmdzcdJq536xrUKJD0LCAGWxh5KnXKj/ztLA==">生命周期</a>内， 只有 <code>beforeCreate</code> 和 <code>created</code> 这两个钩子方法会在 *客户端和服务端均被调用*。其他钩子方法仅在客户端被调用。</strong></li>
<li><strong>static</strong>: 静态文件。放置不需要经过 webpack 打包的静态资源。如一些 js, css 库。</li>
<li><strong>store</strong>: 状态管理。具体使用请移步至 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=AoDbP9LRa208Jyhj1oUPIA==.HxvxiMQv3Ou9U/o63GW1kHUDxq1nayYomZ4NobYa53IoUibLC+hvDekNvNidL7jG">官网</a>。</li>
<li><strong>nuxt.config.js</strong>: <code>nuxt.config.js</code> 文件用于组织Nuxt.js 应用的个性化配置，以便覆盖默认配置。具体配置请移步至 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=Jc3I+GhOcRlE+zP4oHVOSg==.kIVDMKTG/k4jeQsbrBeoBQGx0XP8cxDpRRJHmiXoxH5OpCLe8ayNBuoii6KFqGgq">官网</a>。</li>
</ol>
<h3 id="Nuxt-特有函数"><a href="#Nuxt-特有函数" class="headerlink" title="Nuxt 特有函数"></a>Nuxt 特有函数</h3><p>首先，了解一下在 nuxt 的页面中独有的函数&#x2F;变量：</p>
<h4 id="asyncData-context"><a href="#asyncData-context" class="headerlink" title="asyncData(context)"></a>asyncData(context)</h4><p><code>asyncData</code>方法使得你能够在渲染组件之前异步获取数据。该方法在<strong>服务端</strong>中执行的，所以，请求数据时，<strong>不存在跨域问题</strong>。返回的数据将与 <code>data()</code> 返回的数据进行合并。<strong>由于<code>asyncData</code>方法是在组件 *初始化* 前被调用的，所以在方法内是没有办法通过 <code>this</code> 来引用组件的实例对象。</strong></p>
<p><code>context</code> 变量的可用属性一览：</p>
<table>
<thead>
<tr>
<th>属性字段</th>
<th>类型</th>
<th>可用</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>isClient</code></td>
<td>Boolean</td>
<td>客户端 &amp; 服务端</td>
<td>是否来自客户端渲染</td>
</tr>
<tr>
<td><code>isServer</code></td>
<td>Boolean</td>
<td>客户端 &amp; 服务端</td>
<td>是否来自服务端渲染</td>
</tr>
<tr>
<td><code>isDev</code></td>
<td>Boolean</td>
<td>客户端 &amp; 服务端</td>
<td>是否是开发(dev) 模式，在生产环境的数据缓存中用到</td>
</tr>
<tr>
<td><code>route</code></td>
<td><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=EhSnyiweglWgdpqp8ODgIA==.xjoo8ztbhJUNMXi8fVa4u6h//LajKkgw1HOL5ujMVjnX3CR3TahY6+KyvRTTsMDJtnopcWfyF1QQSJMQQos5xQ==">vue-router 路由</a></td>
<td>客户端 &amp; 服务端</td>
<td><code>vue-router</code> 路由实例。</td>
</tr>
<tr>
<td><code>store</code></td>
<td><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=olAv4D/AKolrJdt3ilarDQ==.bddJZIl0ZP2wddJojIjmNaJDX2OlzVNvn1NmE10RfoGJS0Ar71/FrJYwr/o4auKrfkq6GmKEOsOaZiU0Rnp5Wyv9uG7cjoZhn1ZQ5fM8Ttg=">vuex 数据流</a></td>
<td>客户端 &amp; 服务端</td>
<td><code>Vuex.Store</code> 实例。<strong>只有vuex 数据流存在相关配置时可用。</strong></td>
</tr>
<tr>
<td><code>env</code></td>
<td>Object</td>
<td>客户端 &amp; 服务端</td>
<td><code>nuxt.config.js</code> 中配置的环境变量, 见 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=WqVZrMizdFRyKc5oV5TwAA==.ZmzeAp9RGrg/dlq+JbdEFa+oV7cQus/k5ZcttCWkKczqXqEVe2dWUndbwwPnhb9U">环境变量 api</a></td>
</tr>
<tr>
<td><code>params</code></td>
<td>Object</td>
<td>客户端 &amp; 服务端</td>
<td>route.params 的别名</td>
</tr>
<tr>
<td><code>query</code></td>
<td>Object</td>
<td>客户端 &amp; 服务端</td>
<td>route.query 的别名</td>
</tr>
<tr>
<td><code>req</code></td>
<td><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=ZTcor6Gj8DnBDdIL0JP1BA==.9T6jIC+XMg64OYEopDFLdfj8RDbJTh+rVGu/mOUtVHneBypb5FKeZJgfgRLt3BnnzkU1bN8XfLSZFqSgeuBt/w5JDh+7LtP+j7zKLls4Nfk=">http.Request</a></td>
<td>服务端</td>
<td>Node.js API 的 Request 对象。如果 nuxt 以中间件形式使用的话，这个对象就根据你所使用的框架而定。<em>nuxt generate 不可用</em>。</td>
</tr>
<tr>
<td><code>res</code></td>
<td><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=4efLqkj2Z6mUjgYtyftj8g==.V5Ao0Iz1WlMXw3MS6p/8lUrhqRm0S3KbPVd4IxipJLLMgrmiCF2anjMVzTUNDC28tVxxDa29s5H/sj8FIwwEDg==">http.Response</a></td>
<td>服务端</td>
<td>Node.js API 的 Response 对象。如果 nuxt 以中间件形式使用的话，这个对象就根据你所使用的框架而定。<em>nuxt generate 不可用</em>。</td>
</tr>
<tr>
<td><code>redirect</code></td>
<td>Function</td>
<td>客户端 &amp; 服务端</td>
<td>用这个方法重定向用户请求到另一个路由。状态码在服务端被使用，默认 302。<code>redirect([status,] path [, query])</code></td>
</tr>
<tr>
<td><code>error</code></td>
<td>Function</td>
<td>客户端 &amp; 服务端</td>
<td>用这个方法展示错误页：<code>error(params)</code>。<code>params</code> 参数应该包含 <code>statusCode</code> 和 <code>message</code> 字段。</td>
</tr>
</tbody></table>
<h4 id="fetch-context"><a href="#fetch-context" class="headerlink" title="fetch(context)"></a>fetch(context)</h4><p><em>fetch 方法用于在渲染页面前填充应用的状态树（store）数据， 与 asyncData 方法类似，不同的是它不会设置组件的数据。为了让获取过程可以异步，<strong>你需要返回一个 Promise</strong>，Nuxt.js 会等这个 promise 完成后再渲染组件。</em></p>
<p><strong>fetch 会在组件每次加载前被调用（在服务端或切换至目标路由之前）。</strong></p>
<h4 id="head"><a href="#head" class="headerlink" title="head"></a>head</h4><p>Nuxt.js 使用了 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=z6lYOgCdPjX1K5Jdxp8h1Q==.pkZ+oJXV11McTaHeBz5VzvEOW83qsrnpj4Kh8neloASuQu9JDPRFAe28LThj4GM7"><code>vue-meta</code></a> 更新应用的 <code>头部标签(Head)</code> 和 <code>html 属性</code>。</p>
<p>用于更新 头部信息。如 title，descripe 等。<strong>在 <code>head</code> 方法里可通过 <code>this</code> 关键字来获取组件的数据。</strong></p>
<h4 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h4><p>指定该页面使用哪个布局文件。默认值为 <code>default</code>。</p>
<h4 id="middleware"><a href="#middleware" class="headerlink" title="middleware"></a>middleware</h4><p>需要执行的中间件，如鉴权的 <code>auth</code>等。</p>
<h4 id="transition"><a href="#transition" class="headerlink" title="transition"></a>transition</h4><p>指定页面切换时的动画效果。支持传入 <code>String</code>, <code>Object</code>, <code>Function</code>。具体配置请移步至 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=RAWcYpUuPwFcTZWtz55mOQ==.X5ahD5RlPNbcwUQpDybb35s/FHUq9+tr9RwAAbKkjKuWRmWH1+dwf7WCyuMZwwzq">官网</a> 。</p>
<h4 id="validate"><a href="#validate" class="headerlink" title="validate"></a>validate</h4><p>Nuxt.js 可以让你在动态路由对应的页面组件中配置一个校验方法用于校验动态路由参数的有效性。</p>
<p>返回 <code>true</code> 说明路由有效，则进入路由页面。返回不是 <code>true</code> 则显示 404 页面。</p>
<h3 id="Begin-Coding"><a href="#Begin-Coding" class="headerlink" title="Begin Coding"></a>Begin Coding</h3><h4 id="前置工作"><a href="#前置工作" class="headerlink" title="前置工作"></a>前置工作</h4><h5 id="API"><a href="#API" class="headerlink" title="API"></a>API</h5><p>在这里，我们使用 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=Di/FwQuM2z/4k3Sv0z6aUg==.ajZ69v213SEpzGGycaj2JGU/UEOTNpdc9RopP9MQZdg=">CNode API</a> 进行开发 Demo.</p>
<h5 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h5><p>请求数据，我们使用 Nuxt 官方提供的 <a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=b16sKUKlk8RKYn8eU5okEw==.GyeT/0Ge3PyKQBq1AVcsgZnvPKpuWgzktdQevhrJcrSoT85hRHV766C/s4oRo8vZ">@nuxtjs&#x2F;axios</a> 安装后，在 nuxt.config.js 中加上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">modules</span>: [</span><br><span class="line">    <span class="string">&#x27;@nuxtjs/axios&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">axios</span>: &#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&#x27;https://cnodejs.org/api/v1&#x27;</span>,</span><br><span class="line">    <span class="comment">// or other axios configs.</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就可以在页面中通过 <code>this.$axios.$get</code> 来获取数据，不需要在每个页面都单独引入 axios.</p>
<h5 id="scss"><a href="#scss" class="headerlink" title="scss"></a>scss</h5><p>需要先安装 sass-loader 和 node-sass</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$    yarn add sass-loader node-sass --dev</span><br></pre></td></tr></table></figure>

<p>如果需要在项目中全局使用某个 scss 文件（如 mixins, vars 等），需要借助 sass-resources-loader : <code>yarn add sass-resources-loader —dev</code>， 还需要在 nuxt.config.js 的 build 配置中调整导出的 loader 配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="title function_">extend</span>(<span class="params">config, &#123; isDev, isClient &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> sassResourcesLoader = &#123;  </span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;sass-resources-loader&#x27;</span>,  </span><br><span class="line">        <span class="attr">options</span>: &#123;  </span><br><span class="line">          <span class="attr">resources</span>: [</span><br><span class="line">            <span class="comment">// 填写需要全局注入 scss 的文件。引入后，所有页面均有效。</span></span><br><span class="line">            <span class="string">&#x27;assets/styles/mixins.scss&#x27;</span>  </span><br><span class="line">          ]</span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 修改 scss sass 引用的 loader。</span></span><br><span class="line">      config.<span class="property">module</span>.<span class="property">rules</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">rule</span>) =&gt;</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (rule.<span class="property">test</span>.<span class="title function_">toString</span>() === <span class="string">&#x27;/\\.vue$/&#x27;</span>) &#123;  </span><br><span class="line">          rule.<span class="property">options</span>.<span class="property">loaders</span>.<span class="property">sass</span>.<span class="title function_">push</span>(sassResourcesLoader)  </span><br><span class="line">          rule.<span class="property">options</span>.<span class="property">loaders</span>.<span class="property">scss</span>.<span class="title function_">push</span>(sassResourcesLoader)  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> ([<span class="string">&#x27;/\\.sass$/&#x27;</span>, <span class="string">&#x27;/\\.scss$/&#x27;</span>].<span class="title function_">indexOf</span>(rule.<span class="property">test</span>.<span class="title function_">toString</span>()) !== -<span class="number">1</span>) &#123;  </span><br><span class="line">          rule.<span class="property">use</span>.<span class="title function_">push</span>(sassResourcesLoader)  </span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;)  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h4><p>首页一般只需要简单的获取首页数据并渲染即可。</p>
<p>主要 代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">asyncData</span>(<span class="params">&#123;app, query&#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(query)</span><br><span class="line">  <span class="comment">// 根据不用的标签获取不同的数据，最后返回话题列表。</span></span><br><span class="line">  <span class="keyword">return</span> app.<span class="property">$axios</span>.$get(<span class="string">`topics?tab=<span class="subst">$&#123;query.tab || <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(res)</span></span><br><span class="line">    <span class="comment">// console.log(JSON.parse(res))</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">list</span>: res.<span class="property">data</span>&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当进入首页时，该函数会被执行， nuxt 会等到获取数据后再和组件的 data 合并，进而渲染数据。在模板中，可以直接使用 list 变量获取数据。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card fluid topic&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;topic in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;topic.id&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">nuxt-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;name: &#x27;topic-id&#x27;, params: &#123;id: topic.id&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;topic-title&quot;</span>&gt;</span>&#123;&#123;topic.title&#125;&#125;<span class="tag">&lt;/<span class="name">nuxt-link</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;topic-info&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mark</span> <span class="attr">v-if</span>=<span class="string">&quot;topic.top&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tertiary&quot;</span>&gt;</span>精华<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mark</span> <span class="attr">v-else</span>&gt;</span>&#123;&#123;tabsObj[topic.tab]&#125;&#125;<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;topic.author.avatar_url&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;topic.author.loginname&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这里提及一下， <code>&lt;nuxt-link /&gt;</code> 和 <code>&lt;a /&gt;</code> 的区别是： <code>nuxt-link</code> 走的是 vue-router 的路由，即网页已为单页面，并且浏览器不会重定向。而 <code>a</code> 标签走的是 <code>window.location.href</code>，每一次点击 <code>a</code> 标签后的页面，都会进行一次服务端渲染，和普通的 PHP 混合开发没有太大的区别。</p>
<p>在这里使用了 <code>nuxt-link</code> 是因为 CNode 的 API 不存在跨域问题，因此可以作为一个单页面应用，体验更好。</p>
<p>因为列表页数据类型有多种，该页面可能会被复用，所以当路由对象发生变化时，需要重新获取数据，这时可以监听路由的变化以做出响应：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;$route&#x27;</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;$route has changed.&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置 seo 优化（这里只是单纯的复制罢了，demo 使用，侵删）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span> + (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">tab</span> ? <span class="string">`- <span class="subst">$&#123;<span class="variable language_">this</span>.tabsObj[<span class="variable language_">this</span>.$route.query.tab]&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">    <span class="attr">meta</span>: [&#123;</span><br><span class="line">      <span class="attr">hid</span>: <span class="string">&#x27;description&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="string">&#x27;CNode：Node.js专业中文社区&#x27;</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="话题详情"><a href="#话题详情" class="headerlink" title="话题详情"></a>话题详情</h4><p>同样的，使用 <code>asyncData</code> 函数进行获取数据，再渲染页面。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">asyncData</span>(<span class="params">&#123;app, params&#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params)</span><br><span class="line">  <span class="keyword">return</span> app.<span class="property">$axios</span>.$get(<span class="string">&#x27;topic/&#x27;</span> + params.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// let data = res.data instanceof String ? JSON.parse(res.data) : res.data</span></span><br><span class="line">    <span class="keyword">let</span> data = res.<span class="property">data</span></span><br><span class="line">    <span class="comment">// console.log(res)</span></span><br><span class="line">    <span class="comment">// let div = document.createElement(&#x27;div&#x27;)</span></span><br><span class="line">    <span class="comment">// div.innerHTML = res.data.data.content</span></span><br><span class="line">    <span class="comment">// res.data.summary = div.innerText.substr(0, 120)</span></span><br><span class="line">    data.<span class="property">summary</span> = data.<span class="property">content</span>.<span class="title function_">replace</span>(<span class="regexp">/&lt;[^&gt;]+&gt;/g</span>,<span class="string">&quot;&quot;</span>).<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">120</span>).<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">detail</span>: data&#125;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;axios.get failed.&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，踩过坑。想使用 div 的 innerText 来过滤掉正文中的 HTML 标签，但是，如果用户是直接进入这个页面的时候，执行 <code>asyncData</code> 时，<code>document</code> 对象是不存在的，从而会报错。也就是说，<strong>当 <code>asyncData</code> 在服务端执行时，是没有 <code>document</code> 和 <code>window</code> 对象的</strong>，请大家注意一下。</p>
<p>作为一个社区，seo 尤为重要，倘若每个页面都需要写一大堆的 head 对象，就会显得尤其的繁琐。所以可以借助 nuxt 的 plugin 机制，将其封装成一个函数，并注入到每一个页面当中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugins/global.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 必传 标题，描述。其他的 meta 标签通过 payload 注入，其中，每个 meta 的 hid 需要是唯一的。</span></span><br><span class="line">    $seo(title, content, payload = []) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">meta</span>: [&#123;</span><br><span class="line">          <span class="attr">hid</span>: <span class="string">&#x27;description&#x27;</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>,</span><br><span class="line">          content</span><br><span class="line">        &#125;].<span class="title function_">concat</span>(payload)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在 nuxt.config.js 中加上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="string">&#x27;~plugins/global.js&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，只需要在页面的 <code>head</code> 的函数中，返回该函数即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.$seo(<span class="variable language_">this</span>.<span class="property">detail</span>.<span class="property">title</span>, <span class="variable language_">this</span>.<span class="property">detail</span>.<span class="property">summary</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fo5dh2n4k5j314k0nq0vu.jpg" alt="详情页 seo"></p>
<p>可见，详情页已经成功的设置了部分 seo 的标签。</p>
<p>以上是 Nuxt 的一些基础配置及应用。</p>
<p>我再去研究一下， fetch 和 store 的结合，将该 demo 继续完善。</p>
<p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=331HKnZd3kx5B1qCBrwcXA==./hS2koJfqK9p6Gks+EtJzWApn0CRW6/euao2ucSNO4Mlp2aqxoM5kTRsykytJaym">Demo 线上地址</a><br><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?enc=HarIRi3qPBbQoNhoQ7QVUw==.WKJ82vJ2UfufyamtZ8nOA4OyetwRWtPtxu3dG4SdihXLLbdB0Ak0qa2gft6EYq13">GitHub 地址</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2018/06/21/Adding-tag-cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/06/21/Adding-tag-cloud/" class="post-title-link" itemprop="url">Adding tag cloud</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-06-21 00:26:30" itemprop="dateCreated datePublished" datetime="2018-06-21T00:26:30-06:00">2018-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
    <span id="/2018/06/21/Adding-tag-cloud/" class="post-meta-item leancloud_visitors" data-flag-title="Adding tag cloud" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Step-1-Install-the-plugin-hexo-tag-cloud"><a href="#Step-1-Install-the-plugin-hexo-tag-cloud" class="headerlink" title="Step 1: Install the plugin hexo-tag-cloud"></a>Step 1: Install the plugin hexo-tag-cloud</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-tag-cloud@^2.0.* --save</span><br></pre></td></tr></table></figure>
<h3 id="Step-2-Configuration"><a href="#Step-2-Configuration" class="headerlink" title="Step 2: Configuration"></a>Step 2: Configuration</h3><h4 id="For-the-Swig"><a href="#For-the-Swig" class="headerlink" title="For the Swig"></a>For the Swig</h4><p>Locate the file <code>bash theme/next/layout/_macro/sidebar.swig</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> site.tags.length &gt; 1 %&#125;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> charset=<span class="string">&quot;utf-8&quot;</span> src=<span class="string">&quot;/js/tagcloud.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> charset=<span class="string">&quot;utf-8&quot;</span> src=<span class="string">&quot;/js/tagcanvas.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;div class=<span class="string">&quot;widget-wrap&quot;</span>&gt;</span><br><span class="line">    &lt;h3 class=<span class="string">&quot;widget-title&quot;</span>&gt;标签云&lt;/h3&gt;</span><br><span class="line">    &lt;div <span class="built_in">id</span>=<span class="string">&quot;myCanvasContainer&quot;</span> class=<span class="string">&quot;widget tagcloud&quot;</span>&gt;</span><br><span class="line">        &lt;canvas width=<span class="string">&quot;250&quot;</span> height=<span class="string">&quot;250&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;resCanvas&quot;</span> style=<span class="string">&quot;width=100%&quot;</span>&gt;</span><br><span class="line">            &#123;&#123; list_tags() &#125;&#125;</span><br><span class="line">        &lt;/canvas&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<h4 id="For-the-ejs"><a href="#For-the-ejs" class="headerlink" title="For the ejs"></a>For the ejs</h4><p>Located the file <code>bash hexo/themes/landscape/layout/_widget/tagcloud.ejs </code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;% <span class="keyword">if</span> (site.tags.length) &#123; %&gt;</span><br><span class="line">    &lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> charset=<span class="string">&quot;utf-8&quot;</span> src=<span class="string">&quot;/js/tagcloud.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> charset=<span class="string">&quot;utf-8&quot;</span> src=<span class="string">&quot;/js/tagcanvas.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;widget-wrap&quot;</span>&gt;</span><br><span class="line">        &lt;h3 class=<span class="string">&quot;widget-title&quot;</span>&gt;Tag Cloud&lt;/h3&gt;</span><br><span class="line">        &lt;div <span class="built_in">id</span>=<span class="string">&quot;myCanvasContainer&quot;</span> class=<span class="string">&quot;widget tagcloud&quot;</span>&gt;</span><br><span class="line">            &lt;canvas width=<span class="string">&quot;250&quot;</span> height=<span class="string">&quot;250&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;resCanvas&quot;</span> style=<span class="string">&quot;width=100%&quot;</span>&gt;</span><br><span class="line">                &lt;%- tagcloud() %&gt;</span><br><span class="line">            &lt;/canvas&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
<h4 id="For-the-jade"><a href="#For-the-jade" class="headerlink" title="For the jade"></a>For the jade</h4><p>Locate the file <code>bash apollo/layout/archive.jade </code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">block container</span><br><span class="line">    include mixins/post</span><br><span class="line">    .archive</span><br><span class="line">        h2(class=<span class="string">&#x27;archive-year&#x27;</span>)= <span class="string">&#x27;Tag Cloud&#x27;</span></span><br><span class="line">        script(<span class="built_in">type</span>=<span class="string">&#x27;text/javascript&#x27;</span>, charset=<span class="string">&#x27;utf-8&#x27;</span>, src=<span class="string">&#x27;/oj-code/js/tagcloud.js&#x27;</span>)</span><br><span class="line">        script(<span class="built_in">type</span>=<span class="string">&#x27;text/javascript&#x27;</span>, charset=<span class="string">&#x27;utf-8&#x27;</span>, src=<span class="string">&#x27;/oj-code/js/tagcanvas.js&#x27;</span>)</span><br><span class="line">        <span class="comment">#myCanvasContainer.widget.tagcloud(align=&#x27;center&#x27;)</span></span><br><span class="line">            canvas<span class="comment">#resCanvas(width=&#x27;500&#x27;, height=&#x27;500&#x27;, style=&#x27;width=100%&#x27;)</span></span><br><span class="line">                !=tagcloud()</span><br><span class="line">            !=tagcloud()</span><br><span class="line">    +postList()</span><br></pre></td></tr></table></figure>
<h3 id="Step-3-Config-the-theme"><a href="#Step-3-Config-the-theme" class="headerlink" title="Step 3: Config the theme"></a>Step 3: Config the theme</h3><p>Locate the config file in your theme folder <code>bash _config.yml </code></p>
<p>Adding new lines below in the end of the config file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-tag-cloud</span></span><br><span class="line">tag_cloud:</span><br><span class="line">    textFont: Trebuchet MS, Helvetica</span><br><span class="line">    textColor: <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">    textHeight: 25</span><br><span class="line">    outlineColor: <span class="string">&#x27;#E2E1D1&#x27;</span></span><br><span class="line">    maxSpeed: 0.1</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2018/05/20/Hexo-update-server-automatically/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/20/Hexo-update-server-automatically/" class="post-title-link" itemprop="url">Hexo: Update server automatically</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-05-20 15:45:26" itemprop="dateCreated datePublished" datetime="2018-05-20T15:45:26-06:00">2018-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
    <span id="/2018/05/20/Hexo-update-server-automatically/" class="post-meta-item leancloud_visitors" data-flag-title="Hexo: Update server automatically" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="How-to-update-the-Hexo-server-automatically"><a href="#How-to-update-the-Hexo-server-automatically" class="headerlink" title="How to update the Hexo server automatically:"></a>How to update the Hexo server automatically:</h2><p>Sometimes you may want to update your Hexo server after editing a post or creating a new one, here is how to use Browsersync to achieve that.</p>
<h3 id="Step-1-Install-the-Browsersync"><a href="#Step-1-Install-the-Browsersync" class="headerlink" title="Step 1: Install the Browsersync"></a>Step 1: Install the Browsersync</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;npm install -g browser-sync</span><br></pre></td></tr></table></figure>
<h3 id="Step-2-Install-Hexo-plugin"><a href="#Step-2-Install-Hexo-plugin" class="headerlink" title="Step 2: Install Hexo plugin"></a>Step 2: Install Hexo plugin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;npm install hexo-browsersync --save</span><br></pre></td></tr></table></figure>
<h3 id="Step-3-Start-your-Hexo-service"><a href="#Step-3-Start-your-Hexo-service" class="headerlink" title="Step 3: Start your Hexo service"></a>Step 3: Start your Hexo service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://marvinliu1.github.io/2018/01/02/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Marvin Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marvin's Blog">
      <meta itemprop="description" content="Take in the good!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Marvin's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/01/02/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-01-02 00:26:30" itemprop="dateCreated datePublished" datetime="2018-01-02T00:26:30-07:00">2018-01-02</time>
    </span>

  
    <span id="/2018/01/02/hello-world/" class="post-meta-item leancloud_visitors" data-flag-title="Hello World" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018  
  <!-- <span itemprop="copyrightYear">2022</span> -->
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Marvin Liu</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"appid":"qAsjmBkdw5m0pBHIrH2owQQT-MdYXbMMI","appkey":"xmNL8CNHrbd2QvJOzWwbj3ny","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>



</body>
</html>
